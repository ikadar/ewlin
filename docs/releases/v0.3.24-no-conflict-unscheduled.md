# Release v0.3.24 – No Conflict for Unscheduled Predecessors

> **Status:** ✅ Released
>
> **Milestone:** M3 (Frontend Integration)
>
> **Release Date:** 2025-12-17
>
> **Git Tag:** `v0.3.24`

---

## Overview

Change precedence validation behavior so that unscheduled predecessor tasks do not create conflicts. Currently, if a predecessor task is not scheduled, the validator returns a PrecedenceConflict. This change allows placing tasks even when predecessors are unscheduled, enabling more flexible scheduling workflows.

---

## Prerequisites

- [x] v0.3.23 - Downtime-Aware Tile Height released
- [x] @flux/schedule-validator package
- [x] Precedence validation logic

---

## Scope

### In Scope

- **R7: No conflict for unscheduled** - Remove PrecedenceConflict when predecessor is unscheduled
- Update precedence validator in @flux/schedule-validator
- Conflict only when predecessor IS scheduled but starts AFTER the proposed task ends

### Out of Scope

- Warnings for unscheduled predecessors (could show advisory message, but not blocking)
- UI indicators for out-of-sequence scheduling (separate feature)
- Backend validation changes (frontend leads on this MVP feature)

---

## Related Documentation

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-VALID-001 (Precedence validation) |

### Requirements

| Document | Sections |
|----------|----------|
| [Validation Requirements](../requirements/) | Precedence rules |

---

## Technical Notes

### Current Implementation

```typescript
// packages/validator/src/validators/precedence.ts (lines 34-47)
const predecessorAssignment = findAssignmentByTaskId(snapshot, predecessor.id);
if (!predecessorAssignment) {
  // Predecessor is not scheduled yet - CURRENTLY RETURNS CONFLICT
  return {
    type: 'PrecedenceConflict',
    message: `Predecessor task must be scheduled first`,
    taskId: proposed.taskId,
    relatedTaskId: predecessor.id,
    details: {
      predecessorTaskId: predecessor.id,
      reason: 'unscheduled',
    },
  };
}
```

### Proposed Change

```typescript
// packages/validator/src/validators/precedence.ts
const predecessorAssignment = findAssignmentByTaskId(snapshot, predecessor.id);
if (!predecessorAssignment) {
  // Predecessor is not scheduled - NO CONFLICT, allow placement
  // The predecessor can be scheduled later (before this task's start)
  return null;
}

// Only check time ordering if predecessor IS scheduled
const predecessorEnd = new Date(predecessorAssignment.scheduledEnd);
const proposedStart = new Date(proposed.scheduledStart);
if (predecessorEnd > proposedStart) {
  return {
    type: 'PrecedenceConflict',
    message: `Predecessor ends after this task starts`,
    taskId: proposed.taskId,
    relatedTaskId: predecessor.id,
    details: {
      predecessorTaskId: predecessor.id,
      predecessorEnd: predecessorAssignment.scheduledEnd,
      proposedStart: proposed.scheduledStart,
      reason: 'time_overlap',
    },
  };
}
```

### Rationale

In backward scheduling workflow, users naturally place the last task first. This means predecessors are unscheduled when placing successor tasks. The current behavior creates friction by blocking this workflow.

The conflict should only occur when:
1. Predecessor IS scheduled, AND
2. Predecessor ends AFTER the successor task starts

### Impact on PHP Backend

The PHP backend delegates validation to the Node.js validator via the `@flux/schedule-validator` package. Changing the validator logic in the package automatically affects both frontend and backend validation.

---

## Feature Checklist

### Validator Package

- [x] **Remove conflict for unscheduled predecessors**
  - Description: Return null (no conflict) when predecessor has no assignment
  - Files: `packages/validator/src/validators/precedence.ts`

- [x] **Update tests for new behavior**
  - Description: Adjust test expectations for unscheduled predecessor case
  - Files: `packages/validator/src/validate.test.ts`

### Documentation

- [x] **Update business rules documentation**
  - Description: Clarify precedence validation behavior
  - Files: Release document updated

---

## Testing Requirements

### Unit Tests

- [x] No conflict when predecessor is unscheduled
- [x] Conflict when predecessor is scheduled and ends after proposed start
- [x] No conflict when predecessor is scheduled and ends before proposed start
- [x] Bypass flag skips precedence validation

### E2E Tests

**Not required** - This is a validator package logic change. Unit tests in `@flux/schedule-validator` fully cover the validation behavior. No new user interactions are introduced.

### Manual Testing

- [x] Can place Task 3 when Tasks 1 and 2 are unscheduled
- [x] Can place Task 2 when Task 1 is unscheduled (after Task 3 placed)
- [x] Conflict shown when Task 1 is scheduled after Task 2's start time
- [x] Backward scheduling workflow works smoothly

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [x] All feature checklist items completed
- [x] All unit tests passing (26 tests)
- [x] TypeScript compiles without errors
- [x] Lint passes (N/A for validator package)
- [x] Documentation updated
- [x] Merged to ux-ui-development branch and validator main branch

---

## Release Notes Draft

```markdown
## v0.3.24 – No Conflict for Unscheduled Predecessors

**Release Date:** TBD

### Summary

Improved scheduling flexibility. Placing a task no longer creates a conflict when predecessor tasks are unscheduled. This enables natural backward scheduling where the last task is placed first.

### What's New

- Unscheduled predecessors don't block task placement
- Conflicts only occur when scheduled predecessors overlap
- Smoother backward scheduling workflow

### Technical

- Updated precedence validator in @flux/schedule-validator
- Affects both frontend and backend validation
```

---

## File Structure

```
packages/validator/src/
├── validators/
│   ├── precedence.ts                    # Logic change
│   └── precedence.test.ts               # Test updates
```
