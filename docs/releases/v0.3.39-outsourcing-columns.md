# Release v0.3.39 â€“ Outsourcing Columns

> **Status:** ğŸŸ¡ In Progress
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-23
>
> **Git Tag:** `v0.3.39`
>
> **Branch:** `ux-ui-development`

---

## Overview

Display outsourced provider columns on the scheduling grid. Providers appear after station columns with distinct visual styling. Unlike stations, provider columns support unlimited parallel tasks using a calendar-style subcolumn layout.

---

## Prerequisites

- [x] `v0.3.38` released (Group Capacity Visualization)
- [x] `OutsourcedProvider` type defined in `@flux/types`
- [x] `TaskAssignment.isOutsourced` flag exists
- [x] Mock provider data generated (ClÃ©ment, Reliure Express)

---

## Scope

### In Scope

**REQ-19: Outsourcing Columns (Provider Display)**

1. **Provider Columns on Grid**
   - Display after station columns (to the right)
   - Own header component with outsource icon (`Building2`)
   - Distinct background color and styling
   - Dotted vertical border on column

2. **Enable Outsourced Assignment Rendering**
   - Remove `if (assignment.isOutsourced) return;` skip logic
   - Route outsourced assignments to provider columns by `targetId`
   - Provider column tiles with dotted thick border

3. **Subcolumn Layout for Parallel Tasks**
   - Calendar-style layout for overlapping tasks
   - Concurrent task detection
   - Greedy subcolumn index assignment algorithm
   - Width calculation: `column_width / max_concurrent_in_range`

### Out of Scope

- Drag & drop to provider columns (future release)
- Provider capacity limits (providers are always unlimited)
- Provider-specific similarity criteria

---

## Related Documentation

### Requirements

| Document | Sections |
|----------|----------|
| [Refactored Requirements](../ux-ui/tmp/refactored-new-requirements-en.md) | REQ-19 |

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-PROVIDER-003, BR-GROUP-003 |

### Existing Components

| Component | File | Current State |
|-----------|------|---------------|
| SchedulingGrid | `src/components/SchedulingGrid/SchedulingGrid.tsx` | Skips outsourced assignments |
| StationColumn | `src/components/StationColumn/StationColumn.tsx` | Only station tiles |
| StationHeader | `src/components/StationHeaders/StationHeader.tsx` | No provider variant |
| Tile | `src/components/Tile/Tile.tsx` | No outsourced styling |

---

## Technical Notes

### Provider Column Visual Styling

```
Station Columns                    Provider Columns
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”
â”‚ Komori   â”‚ Massicot â”‚           â”‚ ClÃ©ment (Building2) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”„â”„â”„â”„â”„â”„â”„â”„â”„â”¬â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”¤
â”‚  Tile A  â”‚  Tile C  â”‚           â”Š Task X  â”Š Task Y   â”Š  â† Parallel subcolumns
â”‚          â”‚          â”‚           â”Š         â”Š          â”Š
â”‚  Tile B  â”‚          â”‚           â”Š         â”Š Task Z   â”Š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”„â”„â”„â”„â”„â”„â”„â”„â”„â”´â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”˜
```

### Visual Differences from Station Columns

| Property | Station Column | Provider Column |
|----------|----------------|-----------------|
| Border | Solid | Dotted |
| Background | `bg-zinc-800` | `bg-zinc-900` (darker) |
| Header icon | Factory/Machine icon | `Building2` (outsource) |
| Tile border | Solid | Dotted thick |
| Capacity | Limited (max X) | Unlimited |

### Subcolumn Layout Algorithm

For a provider column with concurrent tasks:

```
08:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Task A   â”‚   Task B   â”‚   â† 2 concurrent â†’ 2 subcolumns
09:00  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
09:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
       â”‚   Task C   â”‚            â”‚   â† Task C starts, still 2 subcolumns
10:00  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
10:00  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       Task D           â”‚   â† 1 task â†’ full width
11:00  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Algorithm:**
1. Find all concurrent tasks at each time point
2. Calculate max concurrent count for the visible time range
3. Assign subcolumn index to each task (greedy: first available slot)
4. Calculate width: `100% / maxConcurrent`
5. Calculate left position: `subcolumnIndex * widthPercent`

### Mock Data Providers

| Provider | Supported Actions | Group ID |
|----------|-------------------|----------|
| ClÃ©ment | binding, laminating | grp-clement |
| Reliure Express | binding | grp-reliure |

---

## Feature Checklist

### Provider Column Component

- [ ] **Create ProviderColumn component**
  - Description: Column component for outsourced providers with dotted border
  - Files: `src/components/ProviderColumn/ProviderColumn.tsx`
  - Tests: Unit tests

- [ ] **Create ProviderHeader component**
  - Description: Header with provider name and Building2 icon
  - Files: `src/components/ProviderColumn/ProviderHeader.tsx`
  - Tests: Unit tests

### Grid Integration

- [ ] **Add providers prop to SchedulingGrid**
  - Description: Accept `OutsourcedProvider[]` from App.tsx
  - Files: `SchedulingGrid.tsx`, `App.tsx`
  - Tests: Integration tests

- [ ] **Render provider columns after stations**
  - Description: Map providers to ProviderColumn components
  - Files: `SchedulingGrid.tsx`
  - Tests: Integration tests

- [ ] **Enable outsourced assignment rendering**
  - Description: Remove `if (assignment.isOutsourced) return;` skip, route to providers
  - Files: `SchedulingGrid.tsx`
  - Tests: Unit tests

### Subcolumn Layout

- [ ] **Create subcolumn calculation utility**
  - Description: Calculate concurrent tasks, assign subcolumn indices
  - Files: `src/utils/subcolumnLayout.ts`
  - Tests: Unit tests

- [ ] **Apply subcolumn positioning to tiles**
  - Description: Set width and left position based on subcolumn index
  - Files: `ProviderColumn.tsx`
  - Tests: Unit tests

### Outsourced Tile Styling

- [ ] **Add outsourced styling to Tile**
  - Description: Dotted thick border for outsourced tiles
  - Files: `Tile.tsx`
  - Tests: Unit tests

---

## Testing Requirements

### Unit Tests

- [ ] ProviderColumn renders correctly
- [ ] ProviderHeader shows provider name and icon
- [ ] Subcolumn layout calculates concurrent tasks correctly
- [ ] Subcolumn index assignment is greedy (first available)
- [ ] Outsourced tiles have dotted border

### E2E Tests

- [ ] Provider columns appear after station columns
- [ ] Outsourced assignments render in provider columns
- [ ] Parallel tasks display in subcolumns
- [ ] Provider header shows Building2 icon

### Manual Testing

- [ ] Provider columns visible on grid
- [ ] Outsourced tasks appear in correct provider column
- [ ] Parallel tasks side by side in subcolumns
- [ ] Dotted borders visible on provider column and tiles

---

## Manual QA Test Plan

### Test Fixtures

| Fixture | URL | Purpose |
|---------|-----|---------|
| `test` | `http://localhost:5173/?fixture=test` | Default with outsourced providers |

### Test Scenarios

#### Scenario 1: Provider Columns Visible

**Steps:**
1. Load the application
2. Scroll right past station columns

**Expected Results:**
- [ ] Provider columns (ClÃ©ment, Reliure Express) visible
- [ ] Provider header shows Building2 icon
- [ ] Dotted vertical border on columns

#### Scenario 2: Outsourced Tasks Render

**Steps:**
1. Find a job with outsourced tasks
2. Look at provider columns

**Expected Results:**
- [ ] Outsourced tasks appear as tiles in provider columns
- [ ] Tiles have dotted thick border
- [ ] Correct vertical positioning by time

#### Scenario 3: Parallel Task Layout

**Steps:**
1. Find time period with concurrent outsourced tasks
2. Observe the layout

**Expected Results:**
- [ ] Tasks appear side by side in subcolumns
- [ ] Width divided equally among concurrent tasks
- [ ] No overlapping tiles

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] All E2E tests passing
- [ ] Manual testing completed
- [ ] Code reviewed and approved
- [ ] Documentation updated (roadmap)
- [ ] Git tag created: `v0.3.39`

---

## Release Notes Draft

```markdown
## v0.3.39 â€“ Outsourcing Columns

**Release Date:** 2025-12-23

### Summary

Display outsourced provider columns on the scheduling grid. Providers appear after station columns with distinct visual styling (dotted borders, darker background). Provider columns support unlimited parallel tasks using a calendar-style subcolumn layout.

### What's New

- **Provider Columns:** ClÃ©ment and Reliure Express appear after station columns
- **Outsourced Task Rendering:** Tasks assigned to providers now visible
- **Subcolumn Layout:** Parallel tasks display side by side
- **Visual Distinction:** Dotted borders and Building2 icon for providers

### Technical Details

- REQ-19: Outsourcing Columns (Provider Display)
- New ProviderColumn and ProviderHeader components
- Subcolumn layout algorithm for concurrent tasks
- Integration with existing Tile component
```

---

## Post-Release

- [ ] GitHub release created
- [ ] Roadmap updated
- [ ] Release document status updated
