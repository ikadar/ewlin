# Release v0.3.39 – Outsourcing Columns

> **Status:** ✅ Released
>
> **Milestone:** M3 (Frontend Integration)
>
> **Release Date:** 2025-12-23
>
> **Git Tag:** `v0.3.39`
>
> **Branch:** `ux-ui-development`

---

## Overview

Display outsourced provider columns on the scheduling grid. Providers appear after station columns with distinct visual styling. Unlike stations, provider columns support unlimited parallel tasks using a calendar-style subcolumn layout.

---

## Prerequisites

- [x] `v0.3.38` released (Group Capacity Visualization)
- [x] `OutsourcedProvider` type defined in `@flux/types`
- [x] `TaskAssignment.isOutsourced` flag exists
- [x] Mock provider data generated (Clément, Reliure Express)

---

## Scope

### In Scope

**REQ-19: Outsourcing Columns (Provider Display)**

1. **Provider Columns on Grid**
   - Display after station columns (to the right)
   - Own header component with outsource icon (`Building2`)
   - Distinct background color and styling
   - Dotted vertical border on column

2. **Enable Outsourced Assignment Rendering**
   - Remove `if (assignment.isOutsourced) return;` skip logic
   - Route outsourced assignments to provider columns by `targetId`
   - Provider column tiles with dotted thick border

3. **Subcolumn Layout for Parallel Tasks**
   - Calendar-style layout for overlapping tasks
   - Concurrent task detection
   - Greedy subcolumn index assignment algorithm
   - Width calculation: `column_width / max_concurrent_in_range`

### Out of Scope

- Drag & drop to provider columns (future release)
- Provider capacity limits (providers are always unlimited)
- Provider-specific similarity criteria

---

## Related Documentation

### Requirements

| Document | Sections |
|----------|----------|
| [Refactored Requirements](../ux-ui/tmp/refactored-new-requirements-en.md) | REQ-19 |

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-PROVIDER-003, BR-GROUP-003 |

### Existing Components

| Component | File | Current State |
|-----------|------|---------------|
| SchedulingGrid | `src/components/SchedulingGrid/SchedulingGrid.tsx` | Skips outsourced assignments |
| StationColumn | `src/components/StationColumn/StationColumn.tsx` | Only station tiles |
| StationHeader | `src/components/StationHeaders/StationHeader.tsx` | No provider variant |
| Tile | `src/components/Tile/Tile.tsx` | No outsourced styling |

---

## Technical Notes

### Provider Column Visual Styling

```
Station Columns                    Provider Columns
┌──────────┬──────────┐           ┌┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┐
│ Komori   │ Massicot │           │ Clément (Building2) │
├──────────┼──────────┤           ├┄┄┄┄┄┄┄┄┄┬┄┄┄┄┄┄┄┄┄┄┤
│  Tile A  │  Tile C  │           ┊ Task X  ┊ Task Y   ┊  ← Parallel subcolumns
│          │          │           ┊         ┊          ┊
│  Tile B  │          │           ┊         ┊ Task Z   ┊
└──────────┴──────────┘           └┄┄┄┄┄┄┄┄┄┴┄┄┄┄┄┄┄┄┄┄┘
```

### Visual Differences from Station Columns

| Property | Station Column | Provider Column |
|----------|----------------|-----------------|
| Border | Solid | Dotted |
| Background | `bg-zinc-800` | `bg-zinc-900` (darker) |
| Header icon | Factory/Machine icon | `Building2` (outsource) |
| Tile border | Solid | Dotted thick |
| Capacity | Limited (max X) | Unlimited |

### Subcolumn Layout Algorithm

For a provider column with concurrent tasks:

```
08:00  ┌────────────┬────────────┐
       │   Task A   │   Task B   │   ← 2 concurrent → 2 subcolumns
09:00  └────────────┤            │
09:00  ┌────────────┤            │
       │   Task C   │            │   ← Task C starts, still 2 subcolumns
10:00  └────────────┴────────────┘
10:00  ┌────────────────────────┐
       │       Task D           │   ← 1 task → full width
11:00  └────────────────────────┘
```

**Algorithm:**
1. Find all concurrent tasks at each time point
2. Calculate max concurrent count for the visible time range
3. Assign subcolumn index to each task (greedy: first available slot)
4. Calculate width: `100% / maxConcurrent`
5. Calculate left position: `subcolumnIndex * widthPercent`

### Mock Data Providers

| Provider | Supported Actions | Group ID |
|----------|-------------------|----------|
| Clément | binding, laminating | grp-clement |
| Reliure Express | binding | grp-reliure |

---

## Feature Checklist

### Provider Column Component

- [x] **Create ProviderColumn component**
  - Description: Column component for outsourced providers with dotted border
  - Files: `src/components/ProviderColumn/ProviderColumn.tsx`
  - Tests: Unit tests (9 tests)

- [x] **Create ProviderHeader component**
  - Description: Header with provider name and Building2 icon
  - Files: `src/components/ProviderColumn/ProviderHeader.tsx`
  - Tests: Unit tests (9 tests)

### Grid Integration

- [x] **Add providers prop to SchedulingGrid**
  - Description: Accept `OutsourcedProvider[]` from App.tsx
  - Files: `SchedulingGrid.tsx`, `App.tsx`
  - Tests: Integration tests

- [x] **Render provider columns after stations**
  - Description: Map providers to ProviderColumn components
  - Files: `SchedulingGrid.tsx`
  - Tests: Integration tests

- [x] **Enable outsourced assignment rendering**
  - Description: Route outsourced assignments to provider columns
  - Files: `SchedulingGrid.tsx`
  - Tests: Unit tests

### Subcolumn Layout

- [x] **Create subcolumn calculation utility**
  - Description: Calculate concurrent tasks, assign subcolumn indices
  - Files: `src/utils/subcolumnLayout.ts`
  - Tests: Unit tests (21 tests)

- [x] **Apply subcolumn positioning to tiles**
  - Description: Set width and left position based on subcolumn index
  - Files: `Tile.tsx`
  - Tests: Unit tests

### Outsourced Tile Styling

- [x] **Add outsourced styling to Tile**
  - Description: Dotted thick border for outsourced tiles
  - Files: `Tile.tsx`
  - Tests: Unit tests

---

## Testing Requirements

### Unit Tests

- [x] ProviderColumn renders correctly (9 tests)
- [x] ProviderHeader shows provider name and icon (9 tests)
- [x] Subcolumn layout calculates concurrent tasks correctly (21 tests)
- [x] Subcolumn index assignment is greedy (first available)
- [x] Outsourced tiles have dotted border

### E2E Tests

- [x] Provider columns appear after station columns
- [x] Outsourced assignments render in provider columns
- [x] Parallel tasks display in subcolumns
- [x] Provider header shows Building2 icon

### Manual Testing

- [x] Provider columns visible on grid
- [x] Outsourced tasks appear in correct provider column
- [x] Parallel tasks side by side in subcolumns
- [x] Dotted borders visible on provider column and tiles

---

## Manual QA Test Plan

### Test Fixtures

| Fixture | URL | Purpose |
|---------|-----|---------|
| `test` | `http://localhost:5173/?fixture=test` | Default with outsourced providers |

### Test Scenarios

#### Scenario 1: Provider Columns Visible

**Steps:**
1. Load the application
2. Scroll right past station columns

**Expected Results:**
- [x] Provider columns (Clément, Reliure Express) visible
- [x] Provider header shows Building2 icon
- [x] Dotted vertical border on columns

#### Scenario 2: Outsourced Tasks Render

**Steps:**
1. Find a job with outsourced tasks
2. Look at provider columns

**Expected Results:**
- [x] Outsourced tasks appear as tiles in provider columns
- [x] Tiles have dotted thick border
- [x] Correct vertical positioning by time

#### Scenario 3: Parallel Task Layout

**Steps:**
1. Find time period with concurrent outsourced tasks
2. Observe the layout

**Expected Results:**
- [x] Tasks appear side by side in subcolumns
- [x] Width divided equally among concurrent tasks
- [x] No overlapping tiles

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [x] All feature checklist items completed
- [x] All unit tests passing (604 total, 39 new)
- [x] All E2E tests passing (11 new)
- [x] Manual testing completed
- [x] Code reviewed and approved (PR #12)
- [x] Documentation updated (roadmap)
- [x] Git tag created: `v0.3.39`

---

## Release Notes Draft

```markdown
## v0.3.39 – Outsourcing Columns

**Release Date:** 2025-12-23

### Summary

Display outsourced provider columns on the scheduling grid. Providers appear after station columns with distinct visual styling (dotted borders, darker background). Provider columns support unlimited parallel tasks using a calendar-style subcolumn layout.

### What's New

- **Provider Columns:** Clément and Reliure Express appear after station columns
- **Outsourced Task Rendering:** Tasks assigned to providers now visible
- **Subcolumn Layout:** Parallel tasks display side by side
- **Visual Distinction:** Dotted borders and Building2 icon for providers

### Technical Details

- REQ-19: Outsourcing Columns (Provider Display)
- New ProviderColumn and ProviderHeader components
- Subcolumn layout algorithm for concurrent tasks
- Integration with existing Tile component
```

---

## Post-Release

- [x] GitHub release created
- [x] Roadmap updated
- [x] Release document status updated
