# Release v0.3.1 â€“ Mock API

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-16
>
> **Git Tag:** `v0.3.1`

---

## Overview

This release implements a mock API layer that simulates backend HTTP calls. It provides endpoints for fetching schedule snapshots and performing CRUD operations on assignments. The mock API includes configurable latency to test loading states and uses the generators from v0.3.0.

---

## Prerequisites

- [x] v0.3.0 - Mock Data Generators released

---

## Scope

### In Scope

- **getSnapshot endpoint** - Fetch complete schedule snapshot
- **CRUD operations** - Create, update, delete assignments
- **Configurable latency** - Simulate network delays for testing
- **TypeScript types** - Request/response types matching `@flux/types`

### Out of Scope

- Real HTTP requests (this is mock-only)
- WebSocket/real-time updates
- Authentication/authorization

---

## Related Documentation

### Dependencies

| Package | Purpose |
|---------|---------|
| `@flux/types` | Type definitions for all entities |
| `apps/web/src/mock/` | Data generators from v0.3.0 |

---

## Technical Notes

### API Design

The mock API should mirror the real backend API structure:

```typescript
// Endpoints
mockApi.getSnapshot(): Promise<ScheduleSnapshot>
mockApi.createAssignment(data: CreateAssignmentRequest): Promise<TaskAssignment>
mockApi.updateAssignment(id: string, data: UpdateAssignmentRequest): Promise<TaskAssignment>
mockApi.deleteAssignment(id: string): Promise<void>
mockApi.toggleTaskCompletion(assignmentId: string): Promise<TaskAssignment>
```

### Latency Configuration

```typescript
interface MockApiConfig {
  latencyMs: number;        // Base latency (default: 200ms)
  latencyVariance: number;  // Random variance (default: 100ms)
  failureRate: number;      // Chance of simulated failure (default: 0)
}
```

### State Management

The mock API should:
1. Use the snapshot cache from v0.3.0
2. Apply mutations to the cached snapshot
3. Return updated data after mutations

---

## Feature Checklist

### API Client

- [ ] **createMockApi()**
  - Description: Factory function to create configured mock API instance
  - Files: `apps/web/src/mock/api.ts`
  - Output: MockApi instance with all methods

- [ ] **MockApiConfig type**
  - Description: Configuration interface for mock API
  - Files: `apps/web/src/mock/api.ts`
  - Output: TypeScript interface

### Read Operations

- [ ] **getSnapshot()**
  - Description: Fetch complete schedule snapshot with simulated delay
  - Files: `apps/web/src/mock/api.ts`
  - Output: `Promise<ScheduleSnapshot>`

### Write Operations

- [ ] **createAssignment()**
  - Description: Create new task assignment
  - Files: `apps/web/src/mock/api.ts`
  - Input: `{ taskId, targetId, scheduledStart }`
  - Output: `Promise<TaskAssignment>`

- [ ] **updateAssignment()**
  - Description: Update existing assignment (reschedule)
  - Files: `apps/web/src/mock/api.ts`
  - Input: `{ scheduledStart, scheduledEnd }`
  - Output: `Promise<TaskAssignment>`

- [ ] **deleteAssignment()**
  - Description: Delete assignment (recall tile)
  - Files: `apps/web/src/mock/api.ts`
  - Input: `assignmentId`
  - Output: `Promise<void>`

- [ ] **toggleTaskCompletion()**
  - Description: Toggle task completion status
  - Files: `apps/web/src/mock/api.ts`
  - Input: `assignmentId`
  - Output: `Promise<TaskAssignment>`

### Request/Response Types

- [ ] **CreateAssignmentRequest**
  - Description: Type for create assignment request body
  - Files: `apps/web/src/mock/api.ts`

- [ ] **UpdateAssignmentRequest**
  - Description: Type for update assignment request body
  - Files: `apps/web/src/mock/api.ts`

### Utility Functions

- [ ] **simulateLatency()**
  - Description: Helper to add configurable delay
  - Files: `apps/web/src/mock/api.ts`

- [ ] **simulateFailure()**
  - Description: Helper to randomly fail requests (for error testing)
  - Files: `apps/web/src/mock/api.ts`

### Exports

- [ ] **Update mock/index.ts**
  - Description: Export mock API from main mock module
  - Files: `apps/web/src/mock/index.ts`

---

## Testing Requirements

### Unit Tests

- [ ] getSnapshot returns valid ScheduleSnapshot
- [ ] createAssignment adds new assignment to snapshot
- [ ] updateAssignment modifies existing assignment
- [ ] deleteAssignment removes assignment from snapshot
- [ ] toggleTaskCompletion toggles isCompleted flag
- [ ] Latency simulation works correctly
- [ ] Error simulation works when configured

### Integration Tests

- [ ] Multiple operations maintain data consistency
- [ ] Created assignment appears in subsequent getSnapshot calls

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Documentation updated
- [ ] Git tag created: `v0.3.1`

---

## Release Notes Draft

```markdown
## v0.3.1 â€“ Mock API

**Release Date:** 2025-12-16

### Summary

Mock API layer for simulating backend interactions during frontend development.

### What's New

- getSnapshot() endpoint for fetching schedule data
- CRUD operations for assignments (create, update, delete)
- Task completion toggle
- Configurable latency for testing loading states
- Optional failure simulation for error handling testing

### Technical

- Uses v0.3.0 generators for data
- Mutations applied to in-memory snapshot cache
- Full TypeScript types for all requests/responses
```

---

## File Structure

```
apps/web/src/mock/
â”œâ”€â”€ generators/          # From v0.3.0
â”œâ”€â”€ snapshot.ts          # From v0.3.0
â”œâ”€â”€ api.ts               # NEW: Mock API implementation
â”œâ”€â”€ api.test.ts          # NEW: Mock API tests
â””â”€â”€ index.ts             # Updated: Export API
```
