# Release v0.2.7 – Validation Service Setup

> **Status:** ✅ Released
>
> **Milestone:** M2 (Scheduling Core)
>
> **Target Date:** 2025-12-14
>
> **Git Tag:** `v0.2.7`
>
> **Note:** Converted to git submodule in v0.2.7.1 (`ewlin-validation-service` repository)

---

## Overview

This release creates the Node.js Validation Service - an HTTP server that exposes the `@flux/schedule-validator` package as a REST API. This service will be called by the PHP Assignment Service (M2) to perform authoritative validation before persisting assignments.

Key features:
- Express/Fastify HTTP server
- Health check endpoint (`GET /health`)
- Request logging middleware
- Error handling middleware
- Service infrastructure ready for validation endpoint (v0.2.8)

---

## Prerequisites

- [x] `v0.0.4` released (@flux/schedule-validator package)
- [x] `@flux/types` package available
- [x] pnpm workspace configured

---

## Scope

### In Scope

- New `services/validation-service/` directory
- Express.js HTTP server setup
- `GET /health` endpoint (returns 200 OK)
- Request logging middleware (with timestamp, method, path, duration)
- Error handling middleware (JSON error responses)
- TypeScript configuration
- Package.json with scripts (start, dev, build, test)
- Basic unit tests for middleware
- Integration test for health endpoint

### Out of Scope

- POST /validate endpoint (v0.2.8)
- Request validation (Zod/Joi) (v0.2.8)
- Docker configuration (v0.2.9)
- Authentication/authorization (M4)
- Rate limiting (M4)

---

## Related Documentation

### Architecture

| Document | Sections |
|----------|----------|
| [Decision Records](../architecture/decision-records.md) | ADR-009, ADR-010 |

---

## Technical Notes

### Project Structure

```
services/validation-service/
├── src/
│   ├── index.ts          # Entry point
│   ├── app.ts            # Express app setup
│   ├── middleware/
│   │   ├── logger.ts     # Request logging
│   │   └── errorHandler.ts
│   └── routes/
│       └── health.ts     # Health check route
├── tests/
│   ├── middleware/
│   │   └── logger.test.ts
│   └── routes/
│       └── health.test.ts
├── package.json
├── tsconfig.json
└── vitest.config.ts
```

### Technology Choices

| Choice | Rationale |
|--------|-----------|
| Express.js | Mature, well-documented, simple |
| Vitest | Consistent with @flux/schedule-validator |
| TypeScript | Type safety, consistent with other packages |

### API Design

**GET /health**
- Response: `200 OK`
- Body: `{ "status": "ok", "timestamp": "2025-12-14T10:00:00.000Z" }`

### Logging Format

```
[2025-12-14T10:00:00.000Z] GET /health 200 5ms
```

---

## Feature Checklist

### Project Setup

- [x] **Create services/validation-service directory**
  - Description: Initialize the service directory structure
  - Files: `services/validation-service/`

- [x] **package.json configuration**
  - Description: Configure dependencies and scripts
  - Files: `services/validation-service/package.json`

- [x] **TypeScript configuration**
  - Description: Configure TypeScript for Node.js
  - Files: `services/validation-service/tsconfig.json`

- [x] **Vitest configuration**
  - Description: Configure test runner
  - Files: `services/validation-service/vitest.config.ts`

### Server Setup

- [x] **Express app initialization**
  - Description: Create Express app with middleware
  - Files: `services/validation-service/src/app.ts`

- [x] **Server entry point**
  - Description: Start server on configurable port
  - Files: `services/validation-service/src/index.ts`

### Middleware

- [x] **Request logger middleware**
  - Description: Log all requests with timing
  - Files: `services/validation-service/src/middleware/logger.ts`
  - Tests: `services/validation-service/tests/middleware/logger.test.ts`

- [x] **Error handler middleware**
  - Description: Catch errors and return JSON responses
  - Files: `services/validation-service/src/middleware/errorHandler.ts`
  - Tests: `services/validation-service/tests/middleware/errorHandler.test.ts`

### Routes

- [x] **Health check endpoint**
  - Description: GET /health returns service status
  - Files: `services/validation-service/src/routes/health.ts`
  - Tests: `services/validation-service/tests/routes/health.test.ts`

### Workspace Integration

- [x] **Update pnpm-workspace.yaml**
  - Description: Add services/validation-service to workspace
  - Files: `pnpm-workspace.yaml`

---

## Testing Requirements

### Unit Tests

- [x] Logger middleware logs requests
- [x] Logger middleware includes duration
- [x] Error handler returns JSON
- [x] Error handler includes error message

### Integration Tests

- [x] GET /health returns 200
- [x] GET /health returns JSON with status and timestamp
- [x] Unknown routes return 404

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [x] All feature checklist items completed
- [x] All unit tests passing (12 tests)
- [x] All integration tests passing (9 tests)
- [x] TypeScript compilation successful
- [x] Code reviewed and approved
- [x] CHANGELOG.md updated (monorepo)
- [x] Git tag created: `v0.2.7`

---

## Release Notes Draft

```markdown
## v0.2.7 – Validation Service Setup

**Release Date:** 2025-12-14

### Summary

Creates the Node.js Validation Service foundation - an Express server with health check endpoint, request logging, and error handling. This service will expose the @flux/schedule-validator package as a REST API for the PHP Assignment Service.

### What's New

- New `services/validation-service/` package
- Express.js HTTP server
- GET /health endpoint
- Request logging middleware
- Error handling middleware
- Vitest test configuration

### Technical Details

- Runs on port 3001 (configurable via PORT env)
- Uses @flux/schedule-validator package
- TypeScript with ESM modules
```

---

## Post-Release

- [x] GitHub release created (monorepo)
- [x] pnpm install verified
- [x] Service starts successfully
