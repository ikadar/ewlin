# Release v0.3.22 â€“ Station Compact UI

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** TBD
>
> **Git Tag:** `v0.3.22`

---

## Overview

Frontend UI for the station compact feature. Adds a "Compact" button to station headers that calls the backend compact API endpoint.

---

## Prerequisites

- [x] v0.3.21 - Station Compact API (backend endpoint must exist)
- [x] Station headers component

---

## Scope

### In Scope

- **Compact button** in station header
- **API integration** - call `POST /api/stations/{id}/compact`
- **Loading state** during API call
- **Refresh assignments** after successful compact
- **Error handling** for failed compact

### Out of Scope

- Backend implementation (see v0.3.21)
- Compact all stations at once (post-MVP)
- Undo compact action

---

## Related Documentation

### UX/UI Specification

| Document | Sections |
|----------|----------|
| [Scheduling Grid](../ux-ui/05-components/scheduling-grid.md) | Station Compact |

---

## Technical Notes

### Button Design

| State | Appearance |
|-------|------------|
| Normal | Compress icon, subtle color |
| Hover | Highlighted |
| Loading | Spinner, disabled |
| Disabled | Grayed out (no tiles to compact) |

### API Call

```typescript
const handleCompact = async (stationId: string) => {
  setCompacting(stationId);
  try {
    const response = await fetch(`/api/stations/${stationId}/compact`, {
      method: 'POST',
    });
    const data = await response.json();
    // Update assignments in state with data.assignments
    refreshAssignments();
  } catch (error) {
    showError('Failed to compact station');
  } finally {
    setCompacting(null);
  }
};
```

### Optimistic vs Pessimistic Update

Use **pessimistic update** - wait for API response before updating UI. The compact operation modifies multiple assignments and calculating the result client-side would duplicate backend logic.

---

## Feature Checklist

### Station Header

- [ ] **Compact button**
  - Description: Button with compress icon in header
  - Files: `apps/web/src/components/SchedulingGrid/StationHeader.tsx`

- [ ] **Loading state**
  - Description: Show spinner during API call
  - Files: `apps/web/src/components/SchedulingGrid/StationHeader.tsx`

- [ ] **Disabled state**
  - Description: Disable when no tiles or during loading
  - Files: `apps/web/src/components/SchedulingGrid/StationHeader.tsx`

### API Integration

- [ ] **Compact API call**
  - Description: POST to compact endpoint
  - Files: `apps/web/src/App.tsx` or API hook

- [ ] **Update assignments after compact**
  - Description: Refresh assignment state with response data
  - Files: `apps/web/src/App.tsx`

- [ ] **Error handling**
  - Description: Show error toast on failure
  - Files: `apps/web/src/App.tsx`

---

## Testing Requirements

### Manual Testing

- [ ] Compact button visible in station headers
- [ ] Click shows loading spinner
- [ ] Tiles reposition after successful compact
- [ ] Error shown if API fails
- [ ] Button disabled during loading
- [ ] Works correctly with multiple stations

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Manual testing complete
- [ ] Merged to ux-ui-development branch

---

## Release Notes Draft

```markdown
## v0.3.22 â€“ Station Compact UI

**Release Date:** TBD

### Summary

UI for station compact feature. Click the compact button in any station header to automatically remove empty gaps between tiles.

### What's New

- Compact button in station headers
- Loading state during operation
- Automatic UI refresh after compact

### Requires

- v0.3.21 (Station Compact API) must be deployed
```

---

## File Structure

```
apps/web/src/
â”œâ”€â”€ App.tsx                              # API integration
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SchedulingGrid/
â”‚       â””â”€â”€ StationHeader.tsx            # Compact button
```
