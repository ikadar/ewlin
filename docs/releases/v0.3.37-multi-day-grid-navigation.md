# Release v0.3.37 â€“ Multi-Day Grid Navigation

> **Status:** ðŸŸ¡ In Progress
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-23
>
> **Git Tag:** `v0.3.37`
>
> **Branch:** `ux-ui-development`

---

## Overview

Implement multi-day grid support with navigation and highlighting features. This release enables scrolling between multiple days, synchronizes DateStrip with the grid, and adds visual indicators for departure dates and scheduled days.

---

## Prerequisites

- [x] `v0.3.36` released (Dry Time Precedence)
- [x] DateStrip component exists with basic day navigation
- [x] SchedulingGrid with scroll support

---

## Scope

### In Scope

**REQ-14: Multi-Day Grid Navigation**
- Extend grid to display multiple days (beyond 24h)
- DateStrip click-to-scroll: clicking a date scrolls the grid to that day
- Bidirectional scroll sync: DateStrip and Grid scroll together
- DateStrip scrolls with grid (not fixed position)

**REQ-15: Departure Date Highlight**
- Highlight selected job's departure date on DateStrip
- Styling: `text-red-300`, `bg-red-500/10`, `border-red-500/30`

**REQ-16: Scheduled Days Highlight**
- Show indicator dots on days where selected job has scheduled tasks
- Styling: emerald indicator dot

**REQ-17: Extended Grid Background**
- Grid background (grid lines, now-line) extends when scrolling
- Dynamically calculate grid size based on day count

### Out of Scope

- Virtual scrolling with `@tanstack/virtual` (performance optimization for later)
- Horizontal station scrolling improvements
- Provider columns on right side

---

## Related Documentation

### Requirements

| Document | Sections |
|----------|----------|
| [Refactored Requirements](../ux-ui/tmp/refactored-new-requirements-en.md) | REQ-14, REQ-15, REQ-16, REQ-17 |

### Existing Components

| Component | File | Current State |
|-----------|------|---------------|
| DateStrip | `src/components/DateStrip/DateStrip.tsx` | Basic day list, `onDateClick` prop exists |
| DateCell | `src/components/DateStrip/DateCell.tsx` | Shows day/date, isToday highlighting |
| SchedulingGrid | `src/components/SchedulingGrid/SchedulingGrid.tsx` | Single-day view, scroll methods exposed |
| TimelineColumn | `src/components/TimelineColumn/TimelineColumn.tsx` | Hour markers, now-line |

---

## Technical Notes

### Multi-Day Grid Architecture

**Current State:**
- Grid shows `hoursToDisplay` hours (default 24) starting from `startHour`
- DateStrip shows 21 days but doesn't sync with grid
- `onDateClick` exists but not connected in App.tsx

**Target Architecture:**
- Grid shows `dayCount * 24` hours
- DateStrip and Grid share scroll position
- Click on DateStrip day â†’ Grid scrolls to that day's start

### Scroll Synchronization

```
DateStrip (Y-scroll) â†â†’ Grid (Y-scroll)
       â†“                    â†“
  Day height: 24h * pixelsPerHour
```

**Option 1: Shared scroll container**
- Both DateStrip and Grid in same scroll container
- CSS grid/flex layout handles positioning

**Option 2: Scroll event sync** (Recommended)
- Grid's `onScroll` updates DateStrip scroll position
- DateStrip click calculates target Y and calls `gridRef.scrollToY()`

### DateCell Props Extension

```typescript
interface DateCellProps {
  date: Date;
  isToday?: boolean;
  isDepartureDate?: boolean;  // REQ-15
  hasScheduledTasks?: boolean; // REQ-16
  onClick?: () => void;
}
```

### Grid Height Calculation

```typescript
const dayCount = 7; // or from props
const hoursToDisplay = dayCount * 24;
const totalHeight = hoursToDisplay * pixelsPerHour;
```

---

## Feature Checklist

### REQ-14: Multi-Day Grid Navigation

- [x] **Extend grid to multi-day**
  - Description: Grid displays `dayCount * 24` hours instead of just 24
  - Files: `SchedulingGrid.tsx`, `App.tsx`
  - Tests: Unit tests

- [x] **Connect DateStrip click-to-scroll**
  - Description: `onDateClick` scrolls grid to that day
  - Files: `App.tsx`
  - Tests: E2E tests

- [x] **Implement scroll sync**
  - Description: DateStrip Y-scroll syncs with Grid Y-scroll
  - Files: `DateStrip.tsx`, `App.tsx` or shared container
  - Tests: E2E tests

### REQ-15: Departure Date Highlight

- [x] **Add isDepartureDate prop to DateCell**
  - Description: New prop for departure date styling
  - Files: `DateCell.tsx`
  - Tests: Unit tests

- [x] **Pass departure date to DateStrip**
  - Description: DateStrip receives selected job's departure date
  - Files: `DateStrip.tsx`, `App.tsx`
  - Tests: Unit tests

- [x] **Apply departure date styling**
  - Description: Red styling for departure date cell
  - Files: `DateCell.tsx`
  - Tests: Visual tests

### REQ-16: Scheduled Days Highlight

- [x] **Add hasScheduledTasks prop to DateCell**
  - Description: New prop for scheduled indicator dot
  - Files: `DateCell.tsx`
  - Tests: Unit tests

- [x] **Calculate scheduled days for selected job**
  - Description: Determine which days have assignments for selected job
  - Files: `App.tsx` or utility function
  - Tests: Unit tests

- [x] **Pass scheduled days to DateStrip**
  - Description: DateStrip receives array of scheduled days
  - Files: `DateStrip.tsx`, `App.tsx`
  - Tests: Unit tests

- [x] **Render indicator dot on scheduled days**
  - Description: Emerald dot on days with tasks
  - Files: `DateCell.tsx`
  - Tests: Visual tests

### REQ-17: Extended Grid Background

- [x] **Calculate grid height for multi-day**
  - Description: `totalHeight = dayCount * 24 * pixelsPerHour`
  - Files: `SchedulingGrid.tsx`
  - Tests: Unit tests

- [x] **Extend TimelineColumn for multi-day**
  - Description: Timeline shows hours across multiple days
  - Files: `TimelineColumn.tsx`
  - Tests: Unit tests

- [x] **Now-line positions correctly in multi-day grid**
  - Description: Now-line at correct position regardless of day
  - Files: `TimelineColumn.tsx`
  - Tests: Unit tests

---

## Testing Requirements

### Unit Tests

- [x] DateCell renders departure date styling when `isDepartureDate=true`
- [x] DateCell renders indicator dot when `hasScheduledTasks=true`
- [x] DateStrip passes correct props to DateCells
- [x] Grid height calculation for multi-day
- [x] Scheduled days calculation utility

### E2E Tests

- [x] Click on DateStrip day scrolls grid to that day
- [x] Grid scroll updates DateStrip scroll position
- [x] Departure date highlighted when job selected
- [x] Scheduled days show indicator dots
- [x] Now-line visible at correct position

### Manual Testing

- [ ] DateStrip click scrolls smoothly to target day
- [ ] Scroll sync feels natural (not jittery)
- [ ] Departure date clearly visible (red styling)
- [ ] Scheduled days dots visible (emerald)
- [ ] Grid lines extend correctly for all days

---

## Manual QA Test Plan

### Test Fixtures

| Fixture | URL | Purpose |
|---------|-----|---------|
| `test` | `http://localhost:5173/?fixture=test` | Multi-day scheduling with various jobs |

### Test Scenarios

#### Scenario 1: Click-to-Scroll Navigation

**Steps:**
1. Load the application
2. Click on a date in the DateStrip (e.g., 3 days from now)
3. Observe grid scrolling

**Expected Results:**
- [ ] Grid scrolls smoothly to the clicked date
- [ ] Clicked date is now visible at top of viewport
- [ ] Timeline shows hours for that day

#### Scenario 2: Bidirectional Scroll Sync

**Steps:**
1. Scroll the grid down/up using mouse wheel
2. Observe DateStrip position

**Expected Results:**
- [ ] DateStrip scrolls in sync with grid
- [ ] Current visible day is highlighted or centered in DateStrip
- [ ] No visual lag or jitter

#### Scenario 3: Departure Date Highlight

**Steps:**
1. Select a job with a future departure date
2. Look at the DateStrip

**Expected Results:**
- [ ] Departure date cell has red styling
- [ ] Text color: red-300
- [ ] Background: red-500/10
- [ ] Border: red-500/30

#### Scenario 4: Scheduled Days Indicator

**Steps:**
1. Select a job that has scheduled tasks
2. Look at the DateStrip

**Expected Results:**
- [ ] Days with scheduled tasks show emerald indicator dot
- [ ] Days without tasks have no dot
- [ ] Dot position is consistent

#### Scenario 5: Extended Grid Background

**Steps:**
1. Scroll to a day several days from today
2. Observe grid lines and background

**Expected Results:**
- [ ] Grid lines extend to all days
- [ ] Hour markers visible for all days
- [ ] Background pattern continues

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] All E2E tests passing
- [ ] Manual testing completed
- [ ] Code reviewed and approved
- [ ] Documentation updated (roadmap)
- [ ] Git tag created: `v0.3.37`

---

## Release Notes Draft

```markdown
## v0.3.37 â€“ Multi-Day Grid Navigation

**Release Date:** 2025-12-23

### Summary

Enable multi-day scheduling view with synchronized navigation between DateStrip
and the scheduling grid. Add visual indicators for departure dates and scheduled days.

### What's New

- **Multi-Day Grid:** Grid now displays multiple days (7 days by default)
- **Click-to-Scroll:** Click on a date in DateStrip to jump to that day
- **Scroll Sync:** DateStrip and Grid scroll together
- **Departure Date:** Selected job's departure date highlighted in red
- **Scheduled Days:** Emerald indicator dots on days with scheduled tasks

### Technical Details

- REQ-14: Multi-day grid with click-to-scroll navigation
- REQ-15: Departure date highlight (red styling)
- REQ-16: Scheduled days indicator (emerald dots)
- REQ-17: Extended grid background for multi-day view
```

---

## Post-Release

- [ ] GitHub release created
- [ ] Roadmap updated
- [ ] Release document status updated
