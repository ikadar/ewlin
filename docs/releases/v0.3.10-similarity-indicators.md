# Release v0.3.10 â€“ Similarity Indicators

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-16
>
> **Git Tag:** `v0.3.10`

---

## Overview

This release implements Similarity Indicators - visual link/unlink icons between consecutive tiles showing time-saving potential. When consecutive jobs on a station share characteristics (same paper type, same paper size, etc.), setup time can be reduced.

---

## Prerequisites

- [x] v0.3.9 - Tile Component released

---

## Scope

### In Scope

- **SimilarityIndicators component** - displays link/unlink icons
- **Comparison logic** - compare job properties via fieldPath
- **Integration with SchedulingGrid** - render indicators between consecutive tiles
- **Mock data support** - generate similarity criteria in mock categories

### Out of Scope

- Automatic scheduling optimization based on similarity
- Similarity-based scheduling suggestions
- Tooltip showing criterion names on hover (future enhancement)

---

## Related Documentation

### UX/UI Specification

| Document | Sections |
|----------|----------|
| [Similarity Indicators](../ux-ui/04-visual-feedback/similarity-circles.md) | Full specification |
| [Tile Component](../ux-ui/05-components/tile-component.md) | Integration notes |

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-CATEGORY-001, BR-CATEGORY-003, UI-005 |
| [Domain Vocabulary](../domain-model/domain-vocabulary.md) | SimilarityCriterion, StationCategory |

---

## Visual Specification

### Position

- Horizontal row at top-right corner of the **lower** tile
- `top: -10px` (overlaps junction between tiles)
- `right-3` positioning

### Icons

| State | Icon | Color |
|-------|------|-------|
| Criterion matched | `link` (Lucide) | `text-zinc-400` |
| Criterion not matched | `unlink` (Lucide) | `text-zinc-800` |

### Container

| Property | Value |
|----------|-------|
| Position | `absolute right-3` |
| Top | `-10px` (overlaps tile boundary) |
| Layout | `flex gap-0.5` |
| Padding | `px-1.5 py-1` |
| Border radius | `rounded-full` |

### HTML Reference

```html
<div class="absolute right-3 flex gap-0.5 px-1.5 py-1 rounded-full" style="top: -10px;">
  <i data-lucide="link" class="w-3.5 h-3.5 text-zinc-400"></i>
  <i data-lucide="link" class="w-3.5 h-3.5 text-zinc-400"></i>
  <i data-lucide="link" class="w-3.5 h-3.5 text-zinc-400"></i>
  <i data-lucide="unlink" class="w-3.5 h-3.5 text-zinc-800"></i>
</div>
```

---

## Comparison Logic

### Algorithm

For each pair of consecutive tiles on a station:

1. Get both tiles' jobs
2. Get station's category
3. Get category's similarity criteria
4. For each criterion:
   - Read `fieldPath` (e.g., "paperType")
   - Get value from Job A at fieldPath
   - Get value from Job B at fieldPath
   - Compare values:
     - If both null/undefined â†’ matched (link icon)
     - If one null, one has value â†’ not matched (unlink icon)
     - If equal â†’ matched (link icon)
     - If different â†’ not matched (unlink icon)

### Display Rules

| Situation | Indicators Shown |
|-----------|------------------|
| Two consecutive tiles from different jobs | Yes |
| Two consecutive tiles from same job (multiple tasks) | Yes |
| Only one tile on station | No |
| First tile (no predecessor) | No indicators above it |
| Tile with gap before it | No indicators |

---

## Feature Checklist

### SimilarityIndicators Component

- [ ] **SimilarityIndicators component**
  - Description: Displays link/unlink icons for criteria comparison
  - Files: `apps/web/src/components/Tile/SimilarityIndicators.tsx`
  - Props: `criteria: SimilarityResult[]`

- [ ] **Icon rendering**
  - Description: Render link or unlink icon based on match status
  - Files: `apps/web/src/components/Tile/SimilarityIndicators.tsx`
  - Icons: Lucide `link`, `unlink`

### Comparison Utilities

- [ ] **Comparison function**
  - Description: Compare two jobs against category criteria
  - Files: `apps/web/src/components/Tile/similarityUtils.ts`
  - Function: `compareSimilarity(jobA, jobB, criteria)`

- [ ] **Field path resolver**
  - Description: Get value from job at given field path
  - Files: `apps/web/src/components/Tile/similarityUtils.ts`
  - Function: `getFieldValue(job, fieldPath)`

### Integration

- [ ] **SchedulingGrid integration**
  - Description: Render indicators between consecutive tiles
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

- [ ] **Category lookup**
  - Description: Get category by station's categoryId
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

### Mock Data

- [ ] **Category criteria generation**
  - Description: Ensure mock categories have similarity criteria
  - Files: `apps/web/src/mock/generators/stations.ts`

### Exports

- [ ] **Component exports**
  - Description: Export SimilarityIndicators and utilities
  - Files: `apps/web/src/components/Tile/index.ts`

---

## Testing Requirements

### Unit Tests

- [ ] SimilarityIndicators renders correct number of icons
- [ ] Link icon shown for matched criterion
- [ ] Unlink icon shown for non-matched criterion
- [ ] Null/null comparison returns matched
- [ ] Null/value comparison returns not matched
- [ ] Field path resolution works for nested paths
- [ ] No indicators shown for single tile

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Documentation updated
- [ ] Git tag created: `v0.3.10`

---

## Release Notes Draft

```markdown
## v0.3.10 â€“ Similarity Indicators

**Release Date:** 2025-12-16

### Summary

Visual indicators between consecutive tiles showing time-saving potential based on station category criteria.

### What's New

- SimilarityIndicators component with link/unlink icons
- Comparison logic for job properties via fieldPath
- Integration with SchedulingGrid for consecutive tile rendering

### Technical

- Lucide React icons (link, unlink)
- Field path resolution for job property comparison
- BR-CATEGORY-003 null handling implemented
```

---

## File Structure

```
apps/web/src/components/Tile/
â”œâ”€â”€ SimilarityIndicators.tsx      # New component
â”œâ”€â”€ similarityUtils.ts            # New utilities
â”œâ”€â”€ Tile.tsx                      # (existing)
â”œâ”€â”€ SwapButtons.tsx               # (existing)
â”œâ”€â”€ colorUtils.ts                 # (existing)
â”œâ”€â”€ index.ts                      # Updated exports
â””â”€â”€ Tile.test.tsx                 # Updated tests
```
