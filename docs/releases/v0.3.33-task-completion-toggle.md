# Release v0.3.33 â€“ Task Completion Toggle

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Development)
>
> **Target Date:** 2025-12-22
>
> **Git Tag:** `v0.3.33`

---

## Overview

Add the ability to toggle task completion directly from tiles by clicking on the completion icon (Circle/CircleCheck). This enables quick workflow updates without navigating to a separate view. When toggled, the ProgressSegments in the JobsList will automatically reflect the state change.

---

## Prerequisites

- [x] `v0.3.32` released (Enhanced Job Progression Visualization)

---

## Scope

### In Scope

- Clickable completion icon on Tile component
- Toggle handler with stopPropagation (don't trigger job selection)
- Visual feedback (hover states on icon)
- State update in App.tsx
- Automatic ProgressSegments update

### Out of Scope

- Backend API integration (mock data only)
- Bulk completion operations
- Undo functionality

---

## Related Documentation

### Requirements

| Document | Sections |
|----------|----------|
| User interaction requirements | Tile completion toggle |

### Architecture

| Document | Sections |
|----------|----------|
| Component structure | Tile, ProgressSegments |

---

## Technical Notes

- The Circle/CircleCheck icons from lucide-react need onClick handlers
- Use `stopPropagation()` to prevent click from bubbling to tile's job selection
- Add `cursor-pointer` and hover color change for visual feedback
- Update `assignment.isCompleted` in the snapshot state
- ProgressSegments already uses `getSegmentState()` which checks `assignment.isCompleted`

---

## Feature Checklist

### Tile Component

- [ ] **Add onToggleComplete prop**
  - Description: New callback prop for completion toggle
  - Files: `apps/web/src/components/Tile/Tile.tsx`
  - Tests: `apps/web/src/components/Tile/Tile.test.tsx`

- [ ] **Make icons clickable**
  - Description: Add onClick with stopPropagation to Circle/CircleCheck
  - Files: `apps/web/src/components/Tile/Tile.tsx`

- [ ] **Add hover states**
  - Description: cursor-pointer, color transition on hover
  - Files: `apps/web/src/components/Tile/Tile.tsx`

### App Integration

- [ ] **Wire up toggle handler**
  - Description: Handler in App.tsx that updates assignment.isCompleted
  - Files: `apps/web/src/App.tsx`

- [ ] **Verify ProgressSegments update**
  - Description: Confirm segments reflect completion state changes
  - Files: N/A (automatic via state)

---

## Testing Requirements

### Unit Tests

- [ ] Tile: clicking icon calls onToggleComplete with assignmentId
- [ ] Tile: clicking icon does not call onSelect (stopPropagation)
- [ ] Tile: icon has correct hover classes (cursor-pointer, transition-colors)
- [ ] Tile: completed icon is clickable
- [ ] Tile: incomplete icon is clickable

### E2E Tests

- [ ] Click incomplete icon â†’ tile shows completed icon
- [ ] Click completed icon â†’ tile shows incomplete icon
- [ ] Toggle count changes correctly
- [ ] Completion state persists after toggle back

### Manual Testing

- [ ] Start dev server: `pnpm dev`
- [ ] Load app: `http://localhost:5173/`
- [ ] Verify hover effect on completion icon
- [ ] Verify click toggles between Circle and CircleCheck
- [ ] Verify click does NOT select the job
- [ ] Verify ProgressSegments updates in JobsList

---

## Manual QA Test Plan

### Test Fixtures

| Fixture | URL | Purpose |
|---------|-----|---------|
| Default | `http://localhost:5173/` | Standard mock data with mixed completion states |

### Test Scenarios

#### Scenario 1: Icon Toggle

**Fixture:** Default

**Steps:**
1. Find a tile with an incomplete icon (empty circle)
2. Hover over the icon
3. Click the icon
4. Click the icon again

**Expected Results:**
- [ ] Hover: cursor changes to pointer, color lightens (zinc-600 â†’ zinc-400)
- [ ] First click: icon changes to green checkmark (CircleCheck)
- [ ] Second click: icon changes back to empty circle (Circle)

#### Scenario 2: Stop Propagation (Click Isolation)

**Fixture:** Default

**Steps:**
1. Ensure no job is selected (click empty area if needed)
2. Click on the completion icon of a tile
3. Observe the tile and JobsList
4. Click elsewhere on the same tile (not on icon)

**Expected Results:**
- [ ] Step 2: Only completion state changes, job is NOT selected
- [ ] Step 2: No glow appears on tile
- [ ] Step 2: No highlight in JobsList
- [ ] Step 4: Job IS selected (glow appears, JobsList highlights)

#### Scenario 3: ProgressSegments Update

**Fixture:** Default

**Steps:**
1. Find a tile and locate its job in the JobsList
2. Note the color of the corresponding segment in ProgressSegments
3. Toggle the tile's completion icon
4. Observe the segment in JobsList

**Expected Results:**
- [ ] Incomplete â†’ Complete: segment turns green
- [ ] Complete â†’ Incomplete: segment turns gray (scheduled) or border-only (unscheduled)

#### Scenario 4: Visual Consistency Across Tile Types

**Fixture:** Default

**Steps:**
1. Find a tile WITH setup time (two colored sections)
2. Click the completion icon
3. Find a tile WITHOUT setup time (single section)
4. Click the completion icon

**Expected Results:**
- [ ] Both tile types have clickable icons
- [ ] Toggle works correctly on both
- [ ] Icon position is consistent (top-left of content)

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] All E2E tests passing
- [ ] Manual testing completed
- [ ] TypeScript compilation passes
- [ ] ESLint passes
- [ ] Git tag created: `v0.3.33`

---

## Release Notes Draft

```markdown
## v0.3.33 â€“ Task Completion Toggle

**Release Date:** 2025-12-22

### Summary

Adds the ability to toggle task completion directly from tiles by clicking on the completion icon. This provides a quick way to mark tasks as complete or incomplete without leaving the scheduling view.

### What's New

- Clickable completion icon on tiles (Circle/CircleCheck)
- Hover visual feedback on completion icon
- Real-time update of ProgressSegments in JobsList
- Click isolation (toggling completion doesn't select the job)

### Technical Details

- New `onToggleComplete` prop on Tile component
- Uses stopPropagation to isolate click events
- State flows through App.tsx â†’ SchedulingGrid â†’ Tile
```

---

## Post-Release

- [ ] GitHub release created
- [ ] Tag pushed to ux-ui-development
