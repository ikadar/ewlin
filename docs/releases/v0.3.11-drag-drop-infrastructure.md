# Release v0.3.11 â€“ Drag & Drop Infrastructure

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-16
>
> **Git Tag:** `v0.3.11`

---

## Overview

This release implements the foundational drag and drop infrastructure using @dnd-kit. It enables dragging unscheduled tasks from the Job Details Panel to the Scheduling Grid with visual feedback and 30-minute snap grid.

---

## Prerequisites

- [x] v0.3.10 - Similarity Indicators released
- [x] JobDetailsPanel with TaskList and TaskTile components
- [x] SchedulingGrid with StationColumns

---

## Scope

### In Scope

- **@dnd-kit integration** - Install and configure dnd-kit library
- **DragContext provider** - Wrap app with DndContext
- **Draggable TaskTile** - Make unscheduled tasks draggable
- **Droppable StationColumn** - Make station columns drop targets
- **Drag overlay** - Show tile preview during drag with slight transparency
- **30-minute snap grid** - Snap drop position to 30-minute boundaries

### Out of Scope

- Column focus/collapse during drag (v0.3.12)
- Real-time validation during drag (v0.3.13)
- Actual assignment creation on drop (v0.3.14)
- Repositioning tiles already on grid (future)

---

## Related Documentation

### UX/UI Specification

| Document | Sections |
|----------|----------|
| [Drag and Drop](../ux-ui/01-interaction-patterns/drag-drop.md) | Full drag mechanics specification |
| [Job Details Panel](../ux-ui/05-components/job-details-panel.md) | Drag source (unscheduled tasks) |
| [Column Focus on Drag](../ux-ui/01-interaction-patterns/column-focus-on-drag.md) | Future enhancement reference |

### Technical

| Decision | Choice |
|----------|--------|
| **Library** | [@dnd-kit](https://dndkit.com) - Modern React DnD, hooks-based, accessible |

---

## Technical Notes

### @dnd-kit Setup

```typescript
// Required packages
@dnd-kit/core      // Core DnD functionality
@dnd-kit/sortable  // For future tile reordering (optional for now)
@dnd-kit/utilities // CSS utilities for transforms
```

### Drag Data Structure

```typescript
interface DragData {
  type: 'task';
  taskId: string;
  jobId: string;
  stationId: string; // Target station for this task
}
```

### Drop Data Structure

```typescript
interface DropData {
  type: 'station-column';
  stationId: string;
  time: Date; // Calculated from Y position
}
```

### 30-Minute Snap Grid

- Grid unit: 30 minutes
- Pixels per hour: 80px (from PIXELS_PER_HOUR constant)
- Snap position: `Math.round(y / 40) * 40` (40px = 30 minutes)

---

## Feature Checklist

### DnD Library Setup

- [ ] **Install @dnd-kit packages**
  - Description: Add @dnd-kit/core and @dnd-kit/utilities to dependencies
  - Files: `apps/web/package.json`
  - Command: `pnpm add @dnd-kit/core @dnd-kit/utilities`

### Context Provider

- [ ] **DndContext wrapper**
  - Description: Wrap App with DndContext provider
  - Files: `apps/web/src/App.tsx`

- [ ] **Drag state management**
  - Description: Track active drag item for overlay and styling
  - Files: `apps/web/src/App.tsx`

### Draggable Components

- [ ] **Draggable TaskTile**
  - Description: Make unscheduled TaskTile draggable using useDraggable
  - Files: `apps/web/src/components/JobDetailsPanel/TaskTile.tsx`
  - Condition: Only unscheduled tasks are draggable

- [ ] **Drag data**
  - Description: Include task, job, and station info in drag data
  - Files: `apps/web/src/components/JobDetailsPanel/TaskTile.tsx`

### Droppable Components

- [ ] **Droppable StationColumn**
  - Description: Make StationColumn accept drops using useDroppable
  - Files: `apps/web/src/components/StationColumns/StationColumn.tsx`

- [ ] **Drop zone highlighting**
  - Description: Visual feedback when dragging over valid drop target
  - Files: `apps/web/src/components/StationColumns/StationColumn.tsx`

### Drag Overlay

- [ ] **DragOverlay component**
  - Description: Render dragged tile preview with transparency
  - Files: `apps/web/src/App.tsx`
  - Style: `opacity: 0.8`, follows cursor

- [ ] **Overlay tile styling**
  - Description: TaskTile appearance during drag (matching job color)
  - Files: `apps/web/src/components/JobDetailsPanel/TaskTile.tsx`

### Snap Grid

- [ ] **30-minute snap calculation**
  - Description: Calculate snap position from Y coordinate
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`
  - Logic: `snapY = Math.round(y / 40) * 40`

- [ ] **Time calculation from position**
  - Description: Convert Y position to Date based on startHour
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

### Exports

- [ ] **Hook exports**
  - Description: Export drag-related hooks and utilities if needed
  - Files: `apps/web/src/components/index.ts`

---

## Testing Requirements

### Unit Tests

- [ ] TaskTile renders with draggable attributes when unscheduled
- [ ] TaskTile is not draggable when scheduled
- [ ] Drag data includes correct task, job, station info
- [ ] StationColumn accepts drops
- [ ] StationColumn only accepts matching station drops
- [ ] Snap calculation returns correct 30-minute boundaries
- [ ] Time calculation returns correct Date from Y position

### Integration Tests

- [ ] Drag starts when clicking and moving unscheduled task
- [ ] Drag overlay appears during drag
- [ ] Drop zone highlights when dragging over valid station

### Manual Testing

- [ ] Drag unscheduled task from Job Details Panel
- [ ] See drag overlay following cursor
- [ ] Station column highlights when hovering
- [ ] Release shows snap to 30-minute grid position

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Documentation updated
- [ ] Git tag created: `v0.3.11`

---

## Release Notes Draft

```markdown
## v0.3.11 â€“ Drag & Drop Infrastructure

**Release Date:** 2025-12-16

### Summary

Foundational drag and drop infrastructure using @dnd-kit, enabling task placement from Job Details Panel to Scheduling Grid.

### What's New

- @dnd-kit integration for accessible drag and drop
- Draggable unscheduled tasks in Job Details Panel
- Droppable station columns in Scheduling Grid
- Drag overlay with task preview
- 30-minute snap grid for precise positioning

### Technical

- @dnd-kit/core and @dnd-kit/utilities dependencies
- DndContext provider wrapping application
- useDraggable hook for TaskTile
- useDroppable hook for StationColumn
```

---

## File Structure

```
apps/web/src/
â”œâ”€â”€ App.tsx                              # DndContext wrapper, drag state
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ JobDetailsPanel/
â”‚   â”‚   â””â”€â”€ TaskTile.tsx                 # useDraggable integration
â”‚   â””â”€â”€ StationColumns/
â”‚       â””â”€â”€ StationColumn.tsx            # useDroppable integration
```
