# Release v0.1.8 – Submodule CI/CD Pipelines

> **Status:** ✅ Released
>
> **Milestone:** M1 (Core Domain MVP)
>
> **Release Date:** 2025-12-12
>
> **Git Tag:** `v0.1.8`

---

## Overview

This release establishes **independent CI/CD pipelines** for each submodule repository, enabling:

- Automated testing and linting on every PR
- Branch protection rules requiring CI to pass
- Self-contained development workflow for each repository
- Clear contribution guidelines for the submodule architecture

### Why This Matters

- **Independent validation**: Each repo validates itself without requiring the full monorepo
- **Faster feedback**: CI runs only for the affected package
- **Branch protection**: Prevents broken code from being merged
- **Clear ownership**: Each package has its own quality gates

---

## Prerequisites

- [x] `v0.1.7` released (Station Domain Events)
- [x] All three submodules exist as separate GitHub repositories
- [x] Monorepo CI workflow exists as reference

---

## Scope

### In Scope

| Repository | CI Workflow | Branch Protection |
|------------|-------------|-------------------|
| `ewlin-php-api` | PHPStan (level 8) + PHPUnit | Require PR, require CI pass |
| `ewlin-validator` | TypeScript build + Vitest | Require PR, require CI pass |
| `ewlin-types` | TypeScript build | Require PR, require CI pass |

Additional:
- Documentation for submodule contribution workflow

### Out of Scope

| Item | Reason |
|------|--------|
| NPM publishing | Post-MVP feature |
| Docker builds in submodules | Already handled in monorepo |
| Code coverage reports | Can be added later |
| ESLint in TypeScript packages | Using TypeScript strict mode instead |

---

## Implementation Notes

### ewlin-validator Cross-Repository Dependency

The validator depends on `@flux/types` (private repository). Solution implemented:

1. **Monorepo usage**: Uses `workspace:*` for local development
2. **CI workflow**: Checks out both repositories and builds types locally
3. **Secret required**: `FLUX_TYPES_TOKEN` PAT with read access to ewlin-types

### TypeScript Standalone Build

Both TypeScript packages required standalone `tsconfig.base.json` files to build outside the monorepo context. The CI workflow uses `npm` instead of `pnpm` for simpler dependency resolution.

### ewlin-types dist/ in Repository

The `dist/` folder is now committed to enable tarball-based consumption. This avoids SSH authentication issues for GitHub-referenced dependencies.

---

## Feature Checklist

### ewlin-php-api

- [x] **Create CI workflow**
  - File: `.github/workflows/ci.yml`
  - Jobs: phpstan, phpunit, ci-success
  - Triggers: push to main, PRs to main

- [ ] **Configure branch protection**
  - Require PR for main
  - Require CI to pass
  - Via: GitHub Settings → Branches → Branch protection rules

### ewlin-validator

- [x] **Update package.json dependency**
  - Uses `workspace:*` for monorepo compatibility
  - CI workflow replaces with `file:../types` during build

- [x] **Create CI workflow**
  - File: `.github/workflows/ci.yml`
  - Jobs: build, test, ci-success
  - Cross-repo checkout with `FLUX_TYPES_TOKEN` secret
  - Triggers: push to main, PRs to main

- [ ] **Configure branch protection**
  - Require PR for main
  - Require CI to pass

### ewlin-types

- [x] **Create CI workflow**
  - File: `.github/workflows/ci.yml`
  - Jobs: build
  - Triggers: push to main, PRs to main

- [x] **Include dist/ in repository**
  - Removed `dist/` from `.gitignore`
  - Enables GitHub tarball consumption

- [x] **Add standalone tsconfig.base.json**
  - Required for building outside monorepo context

- [ ] **Configure branch protection**
  - Require PR for main
  - Require CI to pass

### Documentation

- [x] **Create submodule contribution workflow doc**
  - File: `docs/architecture/submodule-contribution-workflow.md`
  - Content: How to work with submodules, CI requirements, PR process

---

## Testing Requirements

### Verification Tests

| Test | Description | Status |
|------|-------------|--------|
| PHP API CI | Push to feature branch, verify PHPStan + PHPUnit run | ✅ Pass |
| Validator CI | Push to feature branch, verify build + test run | ✅ Pass |
| Types CI | Push to feature branch, verify build runs | ✅ Pass |
| Branch protection | Attempt direct push to main (should fail) | Pending config |

### Manual Testing

- [x] Create PR in ewlin-php-api → CI runs automatically
- [x] Create PR in ewlin-validator → CI runs automatically
- [x] Create PR in ewlin-types → CI runs automatically
- [ ] Verify branch protection prevents merging without CI pass

---

## Definition of Done

- [x] All CI workflows created and functional
- [ ] Branch protection rules configured for all 3 repos
- [x] Validator can build standalone (with cross-repo checkout)
- [x] Documentation created
- [x] All CIs pass on main branches
- [ ] CHANGELOG.md updated
- [ ] Git tags created in each affected repo
- [x] Release document completed

---

## Release Notes

## v0.1.8 – Submodule CI/CD Pipelines

**Release Date:** 2025-12-12

### Summary

Establishes independent CI/CD pipelines for each submodule repository, enabling
automated testing, linting, and branch protection.

### What's New

- **ewlin-php-api CI**: PHPStan (level 8) + PHPUnit on every PR
- **ewlin-validator CI**: TypeScript build + Vitest on every PR
- **ewlin-types CI**: TypeScript build on every PR
- **Documentation**: Submodule contribution workflow guide

### Technical Changes

- Added `.github/workflows/ci.yml` to each submodule
- Added standalone `tsconfig.base.json` to TypeScript packages
- Validator CI uses cross-repository checkout with PAT secret
- Types `dist/` folder now committed for dependency resolution

### Breaking Changes

None

### Migration Guide

No migration required. Existing workflows continue to work.

**Note:** The `ewlin-validator` repository requires a `FLUX_TYPES_TOKEN` secret
with read access to `ewlin-types` for CI to function.

---

## Post-Release

- [ ] Configure branch protection rules (manual step)
- [ ] Verify CI runs on next PR to each repo
- [ ] Team notified of new contribution workflow
- [ ] Proceed to v0.1.9 (Job Entity)
