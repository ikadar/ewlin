# Release v0.3.12 – Column Focus on Drag

> **Status:** ✅ Released
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-16
>
> **Git Tag:** `v0.3.12`

---

## Overview

This release implements the column focus behavior during drag operations. When dragging a task from the Job Details Panel, non-target columns collapse to 120px width, focusing attention on the target station. Additionally, tiles from other jobs become muted while the active job's tiles retain their color.

---

## Prerequisites

- [x] v0.3.11 - Drag & Drop Infrastructure released
- [x] DndContext with drag state management
- [x] StationColumn component with useDroppable

---

## Scope

### In Scope

- **Column collapse animation** - Non-target columns collapse to 120px during drag
- **Target column detection** - Keep full width on matching station column
- **Tile muting** - Other job tiles become desaturated during drag
- **Active job highlighting** - Active job tiles keep their color
- **Animation timing** - 150ms ease-out transitions
- **Expand on drop/cancel** - Columns return to full width

### Out of Scope

- Real-time validation during drag (v0.3.13)
- Actual assignment creation on drop (v0.3.14)
- Job-colored position bands (future enhancement)

---

## Related Documentation

### UX/UI Specification

| Document | Sections |
|----------|----------|
| [Column Focus on Drag](../ux-ui/01-interaction-patterns/column-focus-on-drag.md) | Full specification |
| [Drag and Drop](../ux-ui/01-interaction-patterns/drag-drop.md) | Drag mechanics reference |

---

## Technical Notes

### Drag Context Extension

The App component already tracks `activeTask` and `activeJob` state. We need to pass this to:
- StationColumns (for column collapse logic)
- Tile component (for muting logic)

### Column Width Classes

```css
/* Full width (default) */
.station-column { width: 240px; } /* w-60 */

/* Collapsed during drag */
.station-column--collapsed { width: 120px; } /* w-30 */

/* Smooth transition */
.station-column { transition: width 150ms ease-out; }
```

### Tile Muting Styles

```css
/* Muted tiles (other jobs during drag) */
.tile--muted {
  filter: saturate(0.2);
  opacity: 0.6;
}

/* Active job tiles keep their color */
.tile--active-job {
  filter: none;
  opacity: 1;
}
```

### Props Flow

```
App (activeTask, activeJob)
  └─> SchedulingGrid
        └─> StationColumns (draggingTask, draggingJob)
              ├─> StationColumn (isCollapsed)
              └─> Tile (isMuted, isActiveJob)
```

---

## Feature Checklist

### Drag State Propagation

- [x] **Pass drag state to SchedulingGrid**
  - Description: Add activeTask and activeJob props to SchedulingGrid
  - Files: `apps/web/src/App.tsx`, `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

- [x] **Pass drag state to StationColumns**
  - Description: Forward drag state from SchedulingGrid to StationColumns
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`, `apps/web/src/components/StationColumns/StationColumns.tsx`

### Column Collapse

- [x] **Target station detection**
  - Description: Determine which station matches the dragged task's stationId
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

- [x] **Collapsed width class**
  - Description: Apply w-30 (120px) to non-target columns during drag
  - Files: `apps/web/src/components/StationColumns/StationColumn.tsx`

- [x] **Width transition animation**
  - Description: Add CSS transition for smooth collapse/expand (150ms ease-out)
  - Files: `apps/web/src/components/StationColumns/StationColumn.tsx`

### Tile Muting

- [x] **Pass active job to Tile**
  - Description: Add activeJobId prop to Tile component
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`, `apps/web/src/components/Tile/Tile.tsx`

- [x] **Muted tile styling**
  - Description: Apply filter: saturate(0.2) and opacity: 0.6 to non-active job tiles
  - Files: `apps/web/src/components/Tile/Tile.tsx`

- [x] **Active job tile styling**
  - Description: Keep full saturation and opacity for active job tiles
  - Files: `apps/web/src/components/Tile/Tile.tsx`

### Expand on Drop/Cancel

- [x] **Reset on drag end**
  - Description: Ensure columns expand when drag ends (already via activeTask = null)
  - Files: `apps/web/src/App.tsx`

### Type Updates

- [x] **Update component prop types**
  - Description: Add draggingTask, draggingJob, activeJobId to relevant interfaces
  - Files: `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`, `apps/web/src/components/StationColumns/StationColumns.tsx`, `apps/web/src/components/Tile/Tile.tsx`

---

## Testing Requirements

### Unit Tests

- [x] StationColumn collapses to 120px when non-target during drag
- [x] StationColumn stays full width when target station
- [x] StationColumn has transition classes
- [x] Tile has muted styles when activeJobId differs from job.id
- [x] Tile has normal styles when activeJobId matches job.id
- [x] Tile has normal styles when activeJobId is null (no drag)

### Integration Tests

- [x] Columns animate when drag starts
- [x] Columns restore when drag ends
- [x] Tiles from other jobs are muted during drag

### Manual Testing

- [x] Start dragging task from Job Details Panel
- [x] Non-target columns smoothly collapse to 120px
- [x] Target station column stays full width (240px)
- [x] Tiles from current job keep full color
- [x] Tiles from other jobs appear muted/grey
- [x] Drop or cancel restores all columns

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [x] All feature checklist items completed
- [x] All unit tests passing
- [x] TypeScript compiles without errors
- [x] Lint passes
- [x] Documentation updated
- [ ] Git tag created: `v0.3.12`

---

## Release Notes Draft

```markdown
## v0.3.12 – Column Focus on Drag

**Release Date:** 2025-12-16

### Summary

Visual focus enhancement during drag operations. Non-target columns collapse and other job tiles become muted to focus attention on the target station.

### What's New

- Column collapse during drag (non-target columns → 120px)
- Target station stays full width (240px)
- Smooth 150ms transition animation
- Active job tiles keep color, other jobs muted
- Automatic restoration on drop/cancel
```

---

## File Structure

```
apps/web/src/
├── App.tsx                              # Pass activeTask/activeJob to grid
├── components/
│   ├── SchedulingGrid/
│   │   └── SchedulingGrid.tsx           # Forward drag state
│   ├── StationColumns/
│   │   ├── StationColumns.tsx           # Forward drag state to columns
│   │   └── StationColumn.tsx            # Column collapse logic
│   └── Tile/
│       └── Tile.tsx                     # Muting logic
```
