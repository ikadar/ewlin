# Release v0.1.9 – Job Entity

> **Status:** ✅ Released
>
> **Milestone:** M1 (Core Domain MVP)
>
> **Release Date:** 2025-12-13
>
> **Git Tag:** `v0.1.9`

---

## Overview

This release introduces the **Job entity** - the foundational building block for job management in the Flux scheduling system. A Job represents a complete print order consisting of tasks that must be completed by a deadline.

This is the first release in Phase 1B (Job Management Service), focusing solely on the entity structure without API endpoints.

### Why This Matters

- **Core Domain Object**: Jobs are central to the scheduling system - every task belongs to a job
- **Foundation for Phase 1B**: Subsequent releases (v0.1.10-v0.1.19) build on this entity
- **Status Tracking**: JobStatus enum enables workflow state management

---

## Prerequisites

- [x] `v0.1.8` released (Submodule CI/CD Pipelines)
- [x] Station Management complete (v0.1.0-v0.1.7)

---

## Scope

### In Scope

| Feature | Description |
|---------|-------------|
| Job entity | Aggregate root for print orders |
| JobStatus enum | Draft, Planned, InProgress, Delayed, Completed, Cancelled |
| Core fields | reference, client, description, workshopExitDate |
| Color field | Random hex from palette for visual identification |
| Repository | JobRepository with basic CRUD operations |
| Database migration | Job table creation |

### Out of Scope

| Item | Reason | Release |
|------|--------|---------|
| API endpoints | Separate release for cleaner scope | v0.1.10 |
| Task entity | Separate release | v0.1.11 |
| Approval gates (proof, plates) | Separate release | v0.1.14 |
| Paper procurement | Separate release | v0.1.15 |
| Job dependencies | Separate release | v0.1.16 |
| Job comments | Separate release | v0.1.17 |
| Domain events | Separate release | v0.1.18 |

---

## Related Documentation

### Domain Model

| Document | Sections |
|----------|----------|
| [Domain Vocabulary](../domain-model/domain-vocabulary.md) | Job |
| [Business Rules](../domain-model/business-rules.md) | BR-JOB-001 through BR-JOB-010b |

### Business Rules (Applicable to this release)

| Rule | Description |
|------|-------------|
| BR-JOB-001 | Job must have a workshop exit date |
| BR-JOB-009 | Job color must be randomly assigned at creation |

---

## Technical Design

### Job Entity

```php
namespace App\Entity;

class Job
{
    private string $id;
    private string $reference;           // Order reference (BR-JOB-003: manipulable)
    private string $client;              // Customer name
    private string $description;         // Job description
    private JobStatus $status;           // Current workflow state
    private \DateTimeImmutable $workshopExitDate;  // BR-JOB-001: required deadline
    private string $color;               // BR-JOB-009: random hex color
    private \DateTimeImmutable $createdAt;
    private \DateTimeImmutable $updatedAt;
}
```

### JobStatus Enum

```php
namespace App\Entity;

enum JobStatus: string
{
    case Draft = 'draft';           // Job is being defined
    case Planned = 'planned';       // Definition complete, ready for scheduling
    case InProgress = 'in_progress'; // At least one task has started
    case Delayed = 'delayed';       // Scheduled completion exceeds exit date
    case Completed = 'completed';   // All tasks completed
    case Cancelled = 'cancelled';   // Job was cancelled
}
```

### Color Palette

A predefined set of visually distinct colors for job identification:

```php
private const COLOR_PALETTE = [
    '#E53935', // Red
    '#1E88E5', // Blue
    '#43A047', // Green
    '#FB8C00', // Orange
    '#8E24AA', // Purple
    '#00ACC1', // Cyan
    '#FDD835', // Yellow
    '#6D4C41', // Brown
    '#546E7A', // Blue Grey
    '#D81B60', // Pink
];
```

### Directory Structure

```
services/php-api/src/
├── Entity/
│   ├── Job.php
│   └── JobStatus.php
└── Repository/
    └── JobRepository.php

services/php-api/tests/
└── Unit/Entity/
    ├── JobTest.php
    └── JobStatusTest.php
```

---

## Feature Checklist

### Entity Layer

- [x] **JobStatus enum**
  - File: `src/Entity/JobStatus.php`
  - Values: Draft, Planned, InProgress, Delayed, Completed, Cancelled
  - Helper methods: label(), canBeScheduled(), isTerminal(), isActive()
  - Tests: `tests/Unit/Entity/JobStatusTest.php` (23 tests)

- [x] **Job entity**
  - File: `src/Entity/Job.php`
  - Fields: id, reference, client, description, status, workshopExitDate, color, timestamps
  - Constructor with random color assignment
  - Getters and setters with validation
  - Status transition validation (terminal states)
  - Tests: `tests/Unit/Entity/JobTest.php` (29 tests)

### Repository Layer

- [x] **JobRepository**
  - File: `src/Repository/JobRepository.php`
  - Methods: save(), remove(), findAllWithFilters(), findByStatus(), findLateJobs()

### Database

- [x] **Migration**
  - File: `migrations/Version20251213000000.php`
  - Creates `jobs` table
  - Indexes on: status, workshop_exit_date, created_at

---

## Testing Requirements

### Unit Tests

| Test Class | Tests | Assertions |
|------------|-------|------------|
| JobStatusTest | 23 | 42 |
| JobTest | 29 | 81 |
| **Total** | **52** | **123** |

### Test Scenarios

- [x] Job can be created with required fields
- [x] Job receives random color from palette on creation
- [x] Job status defaults to Draft
- [x] Job status can be changed
- [x] Cannot change status from terminal state (Completed/Cancelled)
- [x] workshopExitDate can be modified
- [x] reference can be modified (BR-JOB-003)
- [x] All JobStatus enum values are valid
- [x] Field validation (empty, max length)

---

## Definition of Done

- [x] JobStatus enum implemented
- [x] Job entity implemented with all fields
- [x] JobRepository created
- [x] Database migration created and tested
- [x] All unit tests passing (52 tests, target was 15+)
- [x] PHPStan level 8 passing
- [x] CHANGELOG.md updated
- [x] Git tag created: `v0.1.9`

---

## Release Notes

## v0.1.9 – Job Entity

**Release Date:** 2025-12-13

### Summary

Introduces the Job entity - the foundational domain object for print order management in the Flux scheduling system.

### What's New

- **Job entity**: Core aggregate root for print orders with reference, client, description, and deadline tracking
- **JobStatus enum**: Six workflow states (Draft, Planned, InProgress, Delayed, Completed, Cancelled)
- **Color assignment**: Random hex color from curated palette for visual identification (BR-JOB-009)
- **Database migration**: Job table with appropriate indexes

### Technical Details

- Entity follows DDD aggregate root pattern
- Color palette with 10 visually distinct colors
- Terminal state protection (Completed/Cancelled cannot transition)
- 52 unit tests with 123 assertions

### Breaking Changes

None

### Migration Guide

Run database migrations:
```bash
php bin/console doctrine:migrations:migrate
```

---

## Post-Release

- [ ] Verify database migration on clean install
- [ ] Team notified of new entity availability
- [ ] Proceed to v0.1.10 (Job API Endpoints)
