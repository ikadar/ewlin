# Release v0.2.16 – Business Calendar API

> **Status:** ✅ Released
>
> **Milestone:** M2 (Scheduling Core)
>
> **Target Date:** 2025-12-14
>
> **Git Tag:** `v0.2.16`

---

## Overview

This release exposes the Business Calendar functionality through a REST API endpoint. The BusinessCalendar service already exists (implemented in v0.2.12) for internal use by the EndTimeCalculator. This release adds a public API endpoint for the frontend to query business days and perform date calculations.

Key deliverables:
- GET /api/v1/calendar/open-days endpoint
- Query business days in a date range
- Check if a specific date is a business day
- Calculate business days between dates

---

## Prerequisites

- [x] `v0.2.15` released (Schedule Snapshot)
- [x] BusinessCalendar service (implemented in v0.2.12)
- [x] BusinessCalendar unit tests (23 tests)

---

## Scope

### In Scope

- GET /api/v1/calendar/open-days endpoint with query parameters:
  - `from` (required): Start date (YYYY-MM-DD)
  - `to` (optional): End date (YYYY-MM-DD)
  - `days` (optional): Number of business days to calculate
- Response with:
  - List of business days in range
  - Total count
  - isBusinessDay flag for `from` date
- CalendarController with OpenAPI documentation
- CalendarService for API-level operations
- Request/Response DTOs
- Integration tests for endpoint

### Out of Scope

- Holiday calendar configuration
- Custom non-working days
- Time zone handling (uses server timezone)
- Real-time calendar updates

---

## Related Documentation

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-CALENDAR-001 (business days = weekdays) |

### Architecture

| Document | Sections |
|----------|----------|
| [Decision Records](../architecture/decision-records.md) | ADR-010 (Isomorphic validation) |

---

## Technical Notes

### Endpoint Design

```
GET /api/v1/calendar/open-days?from=2025-12-15&to=2025-12-31

Response 200 OK:
{
  "from": "2025-12-15",
  "to": "2025-12-31",
  "isFromBusinessDay": true,
  "businessDays": [
    "2025-12-15",
    "2025-12-16",
    "2025-12-17",
    "2025-12-18",
    "2025-12-19",
    "2025-12-22",
    ...
  ],
  "count": 12
}
```

### Alternative Query: Calculate N Business Days

```
GET /api/v1/calendar/open-days?from=2025-12-15&days=5

Response 200 OK:
{
  "from": "2025-12-15",
  "to": "2025-12-19",
  "isFromBusinessDay": true,
  "businessDays": [
    "2025-12-15",
    "2025-12-16",
    "2025-12-17",
    "2025-12-18",
    "2025-12-19"
  ],
  "count": 5
}
```

### Validation Rules

- `from` is required and must be a valid date
- Either `to` or `days` must be provided (not both)
- `days` must be positive integer (1-365)
- Maximum range: 365 days

---

## Feature Checklist

### Controller

- [x] **CalendarController::openDays()**
  - Description: GET endpoint returning business days in range
  - Files: `src/Controller/Api/V1/CalendarController.php`
  - Tests: `tests/Integration/Controller/Api/V1/CalendarControllerTest.php`

### Services

- [x] **CalendarService::getOpenDays()**
  - Description: Returns business days between dates or for N days
  - Files: `src/Service/CalendarService.php`
  - Tests: `tests/Unit/Service/CalendarServiceTest.php`

### DTOs

- [x] **OpenDaysRequest DTO**
  - Description: Request validation for query parameters
  - Files: `src/DTO/Calendar/OpenDaysRequest.php`

- [x] **OpenDaysResponse DTO**
  - Description: Response structure for open days endpoint
  - Files: `src/DTO/Calendar/OpenDaysResponse.php`

---

## Testing Requirements

### Unit Tests

- [x] CalendarService.getOpenDaysByRange() - returns business days in date range
- [x] CalendarService.getOpenDaysByCount() - returns N business days from date
- [x] CalendarService - excludes weekends
- [x] CalendarService - handles start on weekend
- [x] CalendarService - handles end on weekend
- [x] CalendarService - same day scenarios

### Integration Tests

- [x] GET /api/v1/calendar/open-days - returns 200 with valid range
- [x] GET /api/v1/calendar/open-days - returns 200 with days parameter
- [x] GET /api/v1/calendar/open-days - returns 400 when from is missing
- [x] GET /api/v1/calendar/open-days - returns 400 when both to and days provided
- [x] GET /api/v1/calendar/open-days - returns 400 when neither to nor days provided
- [x] GET /api/v1/calendar/open-days - returns 400 for invalid date format
- [x] GET /api/v1/calendar/open-days - returns 400 for range > 365 days
- [x] GET /api/v1/calendar/open-days - returns 400 for days > 365
- [x] GET /api/v1/calendar/open-days - returns 400 when to < from
- [x] GET /api/v1/calendar/open-days - excludes weekends
- [x] GET /api/v1/calendar/open-days - shows isFromBusinessDay false on weekend

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [x] All feature checklist items completed
- [x] All unit tests passing
- [x] All integration tests passing
- [x] PHPStan level 8 passing
- [x] Code reviewed and approved
- [x] CHANGELOG.md updated
- [x] Git tag created: `v0.2.16`

---

## Release Notes Draft

```markdown
## v0.2.16 – Business Calendar API

**Release Date:** 2025-12-14

### Summary

Exposes the Business Calendar functionality through a REST API endpoint for frontend use.

### What's New

- **GET /api/v1/calendar/open-days** - Query business days in a date range
- **CalendarService** - API-level operations for business calendar
- **OpenDaysResponse** - Structured response with business days list

### Technical

- Query by date range (`from` + `to`) or by count (`from` + `days`)
- Excludes weekends (Saturday/Sunday)
- Maximum range of 365 days
- PHPStan level 8 compliant
```

---

## Post-Release

- [x] GitHub release created
- [x] Monorepo updated
- [ ] Next release (v0.2.17 - Assignment Domain Events) ready to start
