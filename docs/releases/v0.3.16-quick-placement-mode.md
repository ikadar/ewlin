# Release v0.3.16 â€“ Quick Placement Mode

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-16
>
> **Git Tag:** `v0.3.16`

---

## Overview

Quick Placement Mode is a toggle mode (ALT+Q) for fast, keyboard-driven tile placement optimized for backward scheduling. It allows rapid task placement by clicking on station columns without dragging.

---

## Prerequisites

- [x] v0.3.15 - Tile Swap released
- [x] Drop handling with assignment creation
- [x] Job selection functionality
- [x] Station columns with droppable areas

---

## Scope

### In Scope

- **Toggle mode** - ALT+Q to enable/disable, ESC to exit
- **Placement indicator** - White glowing line that snaps to gaps between tiles
- **Active tile highlight** - White ring/halo on the task being placed in Job Details panel
- **Tooltip** - Task info near cursor
- **No task available state** - Forbidden cursor when no placeable task
- **Click to place** - Place task at snapped position on click
- **Task selection logic** - Backward scheduling order (last unscheduled task with placed successor)

### Out of Scope

- Job navigation shortcuts (ALT+â†‘/â†“) - deferred to v0.3.17
- Complex precedence validation during quick placement (use existing validation)
- Alt+click bypass in quick placement mode (MVP: standard validation only)

---

## Related Documentation

### UX/UI Specification

| Document | Sections |
|----------|----------|
| [Quick Placement Mode](../ux-ui/01-interaction-patterns/quick-placement-mode.md) | Full specification |
| [Backward Scheduling](../ux-ui/03-navigation/backward-scheduling.md) | Workflow context |

### Domain Model

| Document | Sections |
|----------|----------|
| [Business Rules](../domain-model/business-rules.md) | BR-ASSIGN-*, Precedence rules |

---

## Technical Notes

### State Management

```typescript
// Quick Placement Mode state in App.tsx
const [isQuickPlacementMode, setIsQuickPlacementMode] = useState(false);
const [quickPlacementPosition, setQuickPlacementPosition] = useState<{
  stationId: string | null;
  y: number;
  time: string | null;
}>({ stationId: null, y: 0, time: null });
```

### Task Selection Logic

For backward scheduling, the available task is determined by:
1. Filter tasks by the hovered station
2. Filter to unscheduled tasks only
3. Find the task with the highest sequence number where:
   - It has no successor, OR
   - Its immediate successor is already placed

```typescript
function getAvailableTaskForStation(
  job: Job,
  tasks: Task[],
  assignments: TaskAssignment[],
  stationId: string
): Task | null {
  // Get tasks for this job on this station
  const stationTasks = tasks
    .filter(t => t.jobId === job.id && t.type === 'Internal' && t.stationId === stationId)
    .filter(t => !assignments.some(a => a.taskId === t.id));

  // Sort by sequence descending (highest first for backward scheduling)
  stationTasks.sort((a, b) => b.sequence - a.sequence);

  // Find task where successor is placed or no successor exists
  for (const task of stationTasks) {
    const successorTask = tasks.find(t => t.jobId === job.id && t.sequence === task.sequence + 1);
    if (!successorTask || assignments.some(a => a.taskId === successorTask.id)) {
      return task;
    }
  }
  return null;
}
```

### Placement Indicator Component

New component that renders the glowing white line:

```typescript
interface PlacementIndicatorProps {
  y: number;          // Vertical position
  isVisible: boolean; // Show/hide
}
```

### Active Tile Highlight

The TaskTile in JobDetailsPanel needs a prop to show the "active" state:

```typescript
interface TaskTileProps {
  // ... existing props
  isActivePlacement?: boolean; // Show white ring/halo
}
```

---

## Feature Checklist

### Mode Toggle

- [ ] **ALT+Q toggle handler**
  - Description: Toggle quick placement mode on/off
  - Files: `apps/web/src/App.tsx`

- [ ] **ESC key handler**
  - Description: Exit quick placement mode
  - Files: `apps/web/src/App.tsx`

- [ ] **Mode state management**
  - Description: Track isQuickPlacementMode and related state
  - Files: `apps/web/src/App.tsx`

### Task Selection

- [ ] **getAvailableTaskForStation utility**
  - Description: Find placeable task for a station following backward scheduling rules
  - Files: `apps/web/src/utils/quickPlacement.ts`

- [ ] **Track hovered station**
  - Description: Detect which station column the cursor is over
  - Files: `apps/web/src/App.tsx`, `apps/web/src/components/StationColumns/StationColumn.tsx`

### Visual Feedback

- [ ] **PlacementIndicator component**
  - Description: White glowing line that shows placement position
  - Files: `apps/web/src/components/PlacementIndicator/PlacementIndicator.tsx`

- [ ] **Active tile highlight in JobDetailsPanel**
  - Description: White ring/halo on the task being placed
  - Files: `apps/web/src/components/JobDetailsPanel/TaskTile.tsx`

- [ ] **Forbidden cursor state**
  - Description: Show not-allowed cursor when no task available
  - Files: `apps/web/src/components/StationColumns/StationColumn.tsx`

### Placement Action

- [ ] **Click handler in quick placement mode**
  - Description: Place task at clicked position
  - Files: `apps/web/src/App.tsx`

- [ ] **Create assignment on click**
  - Description: Reuse existing assignment creation logic
  - Files: `apps/web/src/App.tsx`

### Integration

- [ ] **Pass quick placement state to SchedulingGrid**
  - Description: Wire props for mode state and handlers
  - Files: `apps/web/src/App.tsx`, `apps/web/src/components/SchedulingGrid/SchedulingGrid.tsx`

- [ ] **Pass active task to JobDetailsPanel**
  - Description: Highlight the active task tile
  - Files: `apps/web/src/App.tsx`, `apps/web/src/components/JobDetailsPanel/JobDetailsPanel.tsx`

---

## Testing Requirements

### Unit Tests

- [ ] getAvailableTaskForStation returns correct task (backward order)
- [ ] getAvailableTaskForStation returns null when no task available
- [ ] ALT+Q toggles mode on/off
- [ ] ESC exits mode
- [ ] Mode requires selected job

### Integration Tests

- [ ] PlacementIndicator renders at correct position
- [ ] Active tile gets white ring styling
- [ ] Cursor changes to forbidden when no task
- [ ] Click creates assignment

### Manual Testing

- [ ] ALT+Q enables mode with visual indicator
- [ ] White line follows cursor and snaps to grid
- [ ] Correct task is highlighted in Job Details panel
- [ ] Click places tile at indicated position
- [ ] Mode disabled when no job selected
- [ ] ESC exits mode

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] TypeScript compiles without errors
- [ ] Lint passes
- [ ] Documentation updated
- [ ] Merged to ux-ui-development branch

---

## Release Notes Draft

```markdown
## v0.3.16 â€“ Quick Placement Mode

**Release Date:** 2025-12-16

### Summary

Quick Placement Mode for fast, keyboard-driven tile placement. Toggle with ALT+Q, click to place tasks at the indicated position. Optimized for backward scheduling workflow.

### What's New

- ALT+Q toggle for Quick Placement Mode
- White glowing placement indicator line
- Active task highlight in Job Details panel
- Click-to-place functionality
- Backward scheduling task selection logic
- Forbidden cursor when no task available

### Technical

- getAvailableTaskForStation utility for task selection
- PlacementIndicator component
- Integration with existing assignment creation
```

---

## File Structure

```
apps/web/src/
â”œâ”€â”€ App.tsx                              # Mode state, toggle handlers, click-to-place
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ quickPlacement.ts                # NEW: Task selection logic
â”‚   â”œâ”€â”€ quickPlacement.test.ts           # NEW: Unit tests
â”‚   â””â”€â”€ index.ts                         # Export quickPlacement
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PlacementIndicator/              # NEW: Directory
â”‚   â”‚   â”œâ”€â”€ PlacementIndicator.tsx       # NEW: Glowing line component
â”‚   â”‚   â”œâ”€â”€ PlacementIndicator.test.tsx  # NEW: Tests
â”‚   â”‚   â””â”€â”€ index.ts                     # NEW: Export
â”‚   â”œâ”€â”€ JobDetailsPanel/
â”‚   â”‚   â””â”€â”€ TaskTile.tsx                 # Modify: Add isActivePlacement prop
â”‚   â”œâ”€â”€ StationColumns/
â”‚   â”‚   â””â”€â”€ StationColumn.tsx            # Modify: Add cursor state, hover tracking
â”‚   â””â”€â”€ SchedulingGrid/
â”‚       â””â”€â”€ SchedulingGrid.tsx           # Modify: Pass quick placement props
```
