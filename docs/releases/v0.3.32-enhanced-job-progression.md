# Release v0.3.32 â€“ Enhanced Job Progression Visualization

> **Status:** ðŸ”´ Not Started
>
> **Milestone:** M3 (Frontend Integration)
>
> **Target Date:** 2025-12-22
>
> **Git Tag:** `v0.3.32`
>
> **Implements:** [REQ-07](../ux-ui/additional-requirements/refactored-new-requirements-en.md#req-07-enhanced-job-progression-visualization)

---

## Overview

This release replaces the simple `ProgressDots` component with a new `ProgressSegments` component that provides richer visualization of job task status. The new component shows:

- **4 task states** based on scheduling and completion status
- **Size-proportional segments** based on task duration
- **Special handling for outsourced tasks** with duration labels

The goal is to provide at-a-glance understanding of job size, task status, and scheduling progress.

---

## Prerequisites

- [x] `v0.3.31` released (Real-Time Drag Snapping)

---

## Scope

### In Scope

- New `ProgressSegments` component with 4 states
- Size-proportional segment widths based on duration
- Outsourced task special rendering (5Ã— width + label)
- Update `JobCard` to pass task/assignment data
- Update `JobsList` to pass task/assignment data to `JobCard`
- Unit tests for state calculation logic
- Flex-wrap layout for multiple rows

### Out of Scope

- Tooltip on hover (future enhancement)
- Click-to-filter functionality
- Backend changes

---

## Related Documentation

### Requirements

| Document | Sections |
|----------|----------|
| [Refactored Requirements](../ux-ui/additional-requirements/refactored-new-requirements-en.md) | REQ-07 |

### Domain Model

| Document | Sections |
|----------|----------|
| [Task Types](../../packages/types/src/task.ts) | Task, InternalTask, OutsourcedTask |
| [Assignment Types](../../packages/types/src/assignment.ts) | TaskAssignment |

---

## Technical Notes

### Task State Calculation

| State | Condition | Color | Class |
|-------|-----------|-------|-------|
| **Unscheduled** | `!assignment` | Empty (border) | `border border-zinc-700` |
| **Scheduled** | `assignment && !isCompleted && scheduledEnd > now` | Gray | `bg-zinc-500` |
| **Completed** | `assignment && isCompleted` | Green | `bg-emerald-500` |
| **Late** | `assignment && !isCompleted && scheduledEnd < now` | Red | `bg-red-500` |

### Segment Width Calculation

| Task Type | Condition | Width |
|-----------|-----------|-------|
| Internal | â‰¤30 min | Fixed 8px (`w-2`) |
| Internal | >30 min | `Math.max(8, (setupMinutes + runMinutes) / 30 * 8)` px |
| Outsourced | Any | 40px (5Ã— standard) with duration label |

### Width Examples

| Duration | Width |
|----------|-------|
| 15 min | 8px (min) |
| 30 min | 8px |
| 60 min | 16px |
| 90 min | 24px |
| 120 min | 32px |
| Outsourced 2 days | 40px + "2JO" label |

### Component Props

```typescript
interface ProgressSegmentsProps {
  /** Tasks for this job */
  tasks: Task[];
  /** Assignments for this job's tasks */
  assignments: TaskAssignment[];
}
```

### Affected Files

| File | Change |
|------|--------|
| `apps/web/src/components/JobsList/ProgressSegments.tsx` | New component |
| `apps/web/src/components/JobsList/JobCard.tsx` | Use ProgressSegments instead of ProgressDots |
| `apps/web/src/components/JobsList/JobsList.tsx` | Pass tasks/assignments to JobCard |
| `apps/web/src/components/JobsList/index.ts` | Export ProgressSegments |

---

## Feature Checklist

### ProgressSegments Component

- [ ] **Create ProgressSegments component**
  - Description: New component with 4 task states
  - Files: `apps/web/src/components/JobsList/ProgressSegments.tsx`
  - Tests: Unit tests

- [ ] **Implement state calculation logic**
  - Description: Determine unscheduled/scheduled/completed/late
  - Files: `apps/web/src/components/JobsList/ProgressSegments.tsx`
  - Tests: Unit tests

- [ ] **Implement width calculation**
  - Description: Duration-based width for internal, fixed 5Ã— for outsourced
  - Files: `apps/web/src/components/JobsList/ProgressSegments.tsx`
  - Tests: Unit tests

- [ ] **Implement outsourced task label**
  - Description: Show "2JO" style label inside outsourced segments
  - Files: `apps/web/src/components/JobsList/ProgressSegments.tsx`
  - Tests: Unit tests

- [ ] **Implement flex-wrap layout**
  - Description: Allow segments to wrap to multiple lines
  - Files: `apps/web/src/components/JobsList/ProgressSegments.tsx`
  - Tests: Visual verification

### Integration

- [ ] **Update JobCard props**
  - Description: Accept tasks and assignments instead of counts
  - Files: `apps/web/src/components/JobsList/JobCard.tsx`
  - Tests: TypeScript compilation

- [ ] **Update JobsList**
  - Description: Pass full task/assignment data to JobCard
  - Files: `apps/web/src/components/JobsList/JobsList.tsx`
  - Tests: TypeScript compilation

### Testing

- [ ] **Unit tests for state calculation**
  - Description: Test all 4 states with various inputs
  - Files: `apps/web/src/components/JobsList/ProgressSegments.test.tsx`

- [ ] **Unit tests for width calculation**
  - Description: Test width formula for internal and outsourced
  - Files: `apps/web/src/components/JobsList/ProgressSegments.test.tsx`

---

## Testing Requirements

### Unit Tests

- [ ] Unscheduled state (no assignment) â†’ border only
- [ ] Scheduled incomplete state â†’ gray background
- [ ] Completed state â†’ green background
- [ ] Late state (scheduledEnd < now) â†’ red background
- [ ] Width calculation for â‰¤30 min â†’ 8px
- [ ] Width calculation for >30 min â†’ proportional
- [ ] Outsourced task â†’ 40px with label

### Manual Testing

- [ ] Start dev server: `pnpm dev`
- [ ] Load fixture: `http://localhost:5173/?fixture=test`
- [ ] Verify progress segments show on job cards
- [ ] Verify different colors for different states
- [ ] Verify proportional widths for longer tasks
- [ ] Verify outsourced tasks show labels

---

## Manual QA Test Plan

### Test Fixtures

| Fixture | URL | Purpose |
|---------|-----|---------|
| `test` | `http://localhost:5173/?fixture=test` | Multiple jobs with various task states |

### Test Scenarios

#### Scenario 1: Verify 4 Task States

**Fixture:** `test`

**Steps:**
1. Look at job cards in the Jobs List
2. Identify tasks with different states

**Expected Results:**
- [ ] Unscheduled tasks: border only (empty inside)
- [ ] Scheduled tasks: gray fill
- [ ] Completed tasks: green fill
- [ ] Late tasks: red fill

#### Scenario 2: Verify Proportional Widths

**Fixture:** `test`

**Steps:**
1. Look at progress segments on different jobs
2. Compare segment widths

**Expected Results:**
- [ ] Shorter tasks have smaller segments
- [ ] Longer tasks have wider segments
- [ ] Minimum width is maintained (not too thin)

#### Scenario 3: Verify Outsourced Tasks

**Fixture:** `test` (if it has outsourced tasks, otherwise create fixture)

**Steps:**
1. Find a job with outsourced tasks
2. Check the segment appearance

**Expected Results:**
- [ ] Outsourced segments are noticeably wider (5Ã—)
- [ ] Label shows duration (e.g., "2JO")
- [ ] Text is readable inside segment

---

## Definition of Done

All items must be checked for the release to be considered complete:

- [ ] All feature checklist items completed
- [ ] All unit tests passing
- [ ] Manual testing completed
- [ ] Lint and TypeScript checks passing
- [ ] Documentation updated (this file)
- [ ] Roadmap updated (mark v0.3.32 as complete)
- [ ] Git tag created: `v0.3.32`
- [ ] GitHub release created

---

## Release Notes Draft

```markdown
## v0.3.32 â€“ Enhanced Job Progression Visualization

**Release Date:** 2025-12-22

### Summary

Job cards now show enhanced task progress visualization with color-coded states
and size-proportional segments, providing at-a-glance understanding of job
status and complexity.

### What's New

- **4 Task States (REQ-07):**
  - Unscheduled: empty border
  - Scheduled: gray fill
  - Completed: green fill
  - Late: red fill

- **Size-Proportional Segments:**
  - Task duration determines segment width
  - Longer tasks are visually larger
  - Outsourced tasks show 5Ã— width with duration label

- **Flex-Wrap Layout:**
  - Progress visualization can wrap to multiple lines for jobs with many tasks

### Technical Details

- New `ProgressSegments` component replaces `ProgressDots`
- State calculation based on assignment existence and completion status
- Width calculation: `Math.max(8, duration / 30 * 8)` px for internal tasks

### Manual QA

Test URL: `http://localhost:5173/?fixture=test`

1. View job cards in the Jobs List
2. Verify different colors for task states
3. Verify wider segments for longer tasks
4. Verify outsourced task labels (if present)

### Related

- Prerequisite: v0.3.31 (Real-Time Drag Snapping)
- Next: v0.3.33 (Top Navigation Bar)
```

---

## Post-Release

- [ ] GitHub release created
- [ ] Verify on ux-ui-development branch
- [ ] Proceed to v0.3.33 implementation
